{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/lucky-register-qrcode/lucky-register-qrcode.vue?7e2b","webpack:///./src/pages/good-luck/good-luck.vue?6204","webpack:///./src/components/lucky-white-list/lucky-white-list.vue?ffa7","webpack:///./src/App.vue?6359","webpack:///./src/App.vue","webpack:///./src/pages/index/index.vue?cc5b","webpack:///./src/components/lucky-image-grid/lucky-image-grid.vue?437f","webpack:///src/components/lucky-image-grid/lucky-image-grid.vue","webpack:///./src/components/lucky-image-grid/lucky-image-grid.vue?b60e","webpack:///./src/components/lucky-image-grid/lucky-image-grid.vue","webpack:///./src/components/lucky-register-qrcode/lucky-register-qrcode.vue?7cae","webpack:///./src/utils/qrcode.js","webpack:///src/components/lucky-register-qrcode/lucky-register-qrcode.vue","webpack:///./src/components/lucky-register-qrcode/lucky-register-qrcode.vue?9031","webpack:///./src/components/lucky-register-qrcode/lucky-register-qrcode.vue","webpack:///./src/components/lucky-white-list/lucky-white-list.vue?4ff2","webpack:///./src/utils/net.js","webpack:///./src/api/index.js","webpack:///src/components/lucky-white-list/lucky-white-list.vue","webpack:///./src/components/lucky-white-list/lucky-white-list.vue?5c58","webpack:///./src/components/lucky-white-list/lucky-white-list.vue","webpack:///./src/components/lucky-people-display/lucky-people-display.vue?58e0","webpack:///src/components/lucky-people-display/lucky-people-display.vue","webpack:///./src/components/lucky-people-display/lucky-people-display.vue?5212","webpack:///./src/components/lucky-people-display/lucky-people-display.vue","webpack:///./src/components/luck-board/luck-board.vue?8a90","webpack:///src/components/luck-board/luck-board.vue","webpack:///./src/components/luck-board/luck-board.vue?42a0","webpack:///./src/components/luck-board/luck-board.vue","webpack:///./src/utils/math.js","webpack:///src/pages/index/index.vue","webpack:///./src/pages/index/index.vue?6c9a","webpack:///./src/pages/index/index.vue","webpack:///./src/pages/register/register.vue?5e26","webpack:///./src/utils/compress-img.js","webpack:///./src/utils/upload_api.js","webpack:///src/pages/register/register.vue","webpack:///./src/pages/register/register.vue?b11a","webpack:///./src/pages/register/register.vue","webpack:///./src/pages/good-luck/good-luck.vue?a1b0","webpack:///src/pages/good-luck/good-luck.vue","webpack:///./src/pages/good-luck/good-luck.vue?0d1a","webpack:///./src/pages/good-luck/good-luck.vue","webpack:///./src/router/index.js","webpack:///./src/main.js","webpack:///./src/components/luck-board/luck-board.vue?0d65","webpack:///./src/components/lucky-people-display/lucky-people-display.vue?a23f","webpack:///./src/components/lucky-white-list/lucky-white-list.vue?4ed3","webpack:///./src/pages/good-luck/good-luck.vue?e22c","webpack:///./src/components/lucky-image-grid/lucky-image-grid.vue?fb04","webpack:///./src/pages/register/register.vue?4993","webpack:///./src/pages/index/index.vue?a0d4","webpack:///./src/pages/index/index.vue?7754","webpack:///./src/components/luck-board/luck-board.vue?2e7c"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","staticRenderFns","script","component","staticClass","class","context","state","S_CONFIRM","_m","staticStyle","_v","_s","validParticipantList","S_START","on","$event","onDrawButtonClick","_e","S_DRAWING","onConfirmYesButtonClick","toStartState","onCountInputChange","model","callback","$$v","$set","_n","expression","_l","img","index","directives","rawName","style","backgroundImage","src","zIndex","randomIndex","randomParticipantList","luckyPeople","forbiddenParticipantList","qrCodeContent","toggleWhiteList","transform","whiteListVisible","marginTop","participantNameList","session","onWhiteListChanged","toggleLuckSessionVisible","luckSessionVisible","onLuckSessionChange","align","item","size","showname","props","type","Array","default","String","validator","indexOf","Boolean","qrcodeBase64Data","generatorQRCode","text","QRCode","toDataURL","margin","version","errorCorrectionLevel","color","dark","light","created","then","tableData","filter","list","includes","trim","tableRowClassName","scopedSlots","_u","fn","scope","row","editable","edit","$index","deleteRow","addWhiteItem","axiosInstance","axios","timeout","withCredentials","net","interceptors","response","use","error","Promise","reject","url","params","_params","resolve","catch","err","post","config","buildUrl","action","createWebsocket","WebSocket","MozWebSocket","Api","avatar","Net","onopenFn","onmessgaeFn","oncloseFn","host","location","websocket","Error","onopen","evt","onmessage","onclose","users","prizes","count","startTime","luckId","people","required","watch","notifyWhiteListChange","loadCheckinList","methods","$emit","saveCheckinList","forEach","code","checkinList","console","message","join","sessionsData","label","prop","formatter","toggleLuckSessionForm","formVisible","ref","sessionForm","upsertLuckSession","cancel","showCreateButton","sessionsSchema","$route","query","computed","currentLuckSession","sessions","sort","requestLuckSessions","$message","finished","res","setTimeout","emitCurrentLuckSession","$refs","resetFields","integerRangeRandom","engine","Random","minInteger","maxInteger","integer","components","LuckyImageGrid","LuckyRegisterQrcode","LuckyWhiteList","LuckyPeopleDisplay","LuckBoard","participantList","whiteList","numLuckyPeople","proposalLuckyPeopleIndexes","interval","validInteger","registerUrl","maxLength","checkedParticipantList","map","Date","now","mounted","addEventListener","event","returnValue","onWebSocketOpen","log","onWebSocketMessage","onMessageEvent","inChecinList","onWebSocketClose","toNextState","toDrawingState","toConfrimState","stateMachine","startDrawing","luckyPeopleNames","from","forbidden","commitLuckyPeople","saveLuckyNamesLocal","requestAnimationFrame","generateRandomIndexes","cloneValidParticipantList","numsIndexes","Math","min","localStorage","setItem","JSON","stringify","forbiddentNames","loadLuckyNamesLocal","parse","forbiddenNamesStr","luckSession","afterRead","userName","register","rotateAndCompressImg","file","Image","URL","createObjectURL","onload","EXIF","orientation","canvas","document","createElement","ctx","getContext","width","height","rotate","PI","drawImage","toBlob","blob","test","rate","content","upload","getTime","random","toString","substr","put","re","status","visit_url","intervalMinutes","DefaultIntervalMinutes","loading","uploading","success","FormDisabled","Number","parseInt","validateAndSaveSession","preSessionExpired","preSession","thisSession","history","KEY_SESSION_HISTORY","clearSession","removeItem","diffMs","intervalMs","sessionHistory","emptyFields","toast","contentAndFile","progressValue","onLuckButtonClick","luck","prize","owner","newLucks","updatePreAllLucks","luckySessions","nowTimestamp","allPeopleNames","luckButtonClicks","luckButtonHandler","preAllLucks","wordsLoopStyle","animationDuration","luckButtonStyle","couldDraw","luckSessionStartTime","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","allLucks","user","diff","clearTimeout","calmdown","Vue","Router","base","routes","path","alias","Index","Register","GoodLuck","productionTip","ElementUI","Vant","_","router","render","h","App","$mount"],"mappings":"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","file":"js/app.0b848184.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-register-qrcode.vue?vue&type=style&index=0&id=66c7cc76&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./good-luck.vue?vue&type=style&index=1&id=12ede7ec&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-white-list.vue?vue&type=style&index=1&lang=less&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('router-view')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=c4c047ec&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"luckydraw\",class:[_vm.context.state === _vm.context.S_CONFIRM ? 'luckydraw-confirming' : '']},[_vm._m(0),_c('el-row',{staticStyle:{\"position\":\"absolute\",\"top\":\"170px\",\"left\":\"0\",\"right\":\"0\",\"bottom\":\"0\"}},[_c('el-col',{staticClass:\"luckydraw-participant\",attrs:{\"span\":6}},[_c('h4',{staticClass:\"luckydraw-participant__title\"},[_vm._v(\" 可参与抽奖人数(\"+_vm._s(_vm.validParticipantList.length)+\") \")]),_c('lucky-image-grid',{staticClass:\"luckydraw-participant__wrapper\",attrs:{\"data\":_vm.validParticipantList}})],1),_c('el-col',{staticClass:\"luckydraw-main\",attrs:{\"span\":12}},[(_vm.context.state === _vm.context.S_START)?_c('el-button',{staticClass:\"luckydraw-main__button luckydraw-main__start\",attrs:{\"size\":\"large\",\"round\":true,\"type\":\"primary\"},on:{\"click\":function($event){return _vm.onDrawButtonClick(_vm.context.S_START)}}}):_vm._e(),(_vm.context.state === _vm.context.S_DRAWING)?_c('el-button',{staticClass:\"luckydraw-main__button luckydraw-main__drawing\",attrs:{\"size\":\"large\",\"round\":true,\"type\":\"primary\"},on:{\"click\":function($event){return _vm.onDrawButtonClick(_vm.context.S_DRAWING)}}}):_vm._e(),(_vm.context.state === _vm.context.S_CONFIRM)?_c('el-row',{staticClass:\"luckydraw-main__confirm\"},[_c('el-col',{attrs:{\"span\":12}},[_c('el-button',{staticClass:\"luckydraw-main__button luckydraw-main__confirm-yes\",attrs:{\"round\":true,\"type\":\"primary\"},on:{\"click\":_vm.onConfirmYesButtonClick}},[_vm._v(\"抽奖有效\")])],1),_c('el-col',{attrs:{\"span\":12}},[_c('el-button',{staticClass:\"luckydraw-main__button luckydraw-main__confirm-no\",attrs:{\"type\":\"weak\",\"round\":true},on:{\"click\":_vm.toStartState}},[_vm._v(\"抽奖无效\")])],1)],1):_vm._e(),_c('el-input',{staticClass:\"luckydraw-main__count-input\",attrs:{\"placeholder\":\"中奖人数\",\"max\":_vm.validParticipantList.length,\"min\":0,\"disabled\":true},on:{\"input\":_vm.onCountInputChange},model:{value:(_vm.context.numLuckyPeople),callback:function ($$v) {_vm.$set(_vm.context, \"numLuckyPeople\", _vm._n($$v))},expression:\"context.numLuckyPeople\"}}),(_vm.context.state === _vm.context.S_START || _vm.context.state === _vm.context.S_DRAWING)?_c('div',{staticClass:\"luckydraw-main__hrl\"},[_c('div',{staticClass:\"luckydraw-main__hrl-viewport\"},_vm._l((_vm.randomParticipantList),function(img,index){return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.context.state === _vm.context.S_DRAWING),expression:\"context.state === context.S_DRAWING\"}],key:index,staticClass:\"img-bg\",style:({backgroundImage: 'url(' + img.src + ')', zIndex: index === (_vm.context.randomIndex % _vm.randomParticipantList.length) ? '1' : '0'})})}),0),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.context.randomIndex > -1),expression:\"context.randomIndex > -1\"}]},[_vm._v(\" \"+_vm._s(_vm.randomParticipantList[_vm.context.randomIndex % _vm.randomParticipantList.length] && _vm.randomParticipantList[_vm.context.randomIndex % _vm.randomParticipantList.length].name)+\" \")])]):_c('lucky-people-display',{staticClass:\"luckydraw-main__lpd\",attrs:{\"data\":_vm.context.luckyPeople}})],1),_c('el-col',{staticClass:\"luckydraw-forbidden\",attrs:{\"span\":6}},[_c('h4',{staticClass:\"luckydraw-forbidden__title\"},[_vm._v(\"已中奖人数(\"+_vm._s(_vm.forbiddenParticipantList.length)+\")\")]),_c('lucky-image-grid',{staticClass:\"luckydraw-forbidden__wrapper\",attrs:{\"data\":_vm.forbiddenParticipantList}})],1)],1),_c('div',{staticClass:\"lucky-register-qrcode\"},[_c('lucky-register-qrcode',{attrs:{\"text\":_vm.qrCodeContent}})],1),_c('div',{staticClass:\"lucky-checkin\"},[_c('a',{staticClass:\"lucky-checkin-button\",attrs:{\"href\":\"javascript: void 0;\"},on:{\"click\":_vm.toggleWhiteList}}),_c('lucky-white-list',{style:({transform: _vm.whiteListVisible ? 'scale(1)' : 'scale(0)', marginTop: '60px'}),attrs:{\"list\":_vm.participantNameList,\"session\":_vm.session},on:{\"changed\":_vm.onWhiteListChanged}})],1),_c('div',{staticClass:\"luck-session\"},[_c('a',{staticClass:\"luck-session-button\",attrs:{\"href\":\"javascript: void 0;\"},on:{\"click\":_vm.toggleLuckSessionVisible}},[_vm._v(\" 抽奖会话 \")]),_c('luck-board',{staticClass:\"luck-board\",style:({transform: _vm.luckSessionVisible ? 'scale(1)' : 'scale(0)', marginTop: '60px' }),on:{\"change\":_vm.onLuckSessionChange}})],1)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{staticClass:\"title\"},[_c('span',{staticStyle:{\"color\":\"#fcea00\"}},[_vm._v(\"2021\")]),_vm._v(\"新年联欢，抽奖现场\")])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"lucky-image-grid\"},[_c('div',{staticClass:\"grid\",class:[{ 'left': 'grid-left', 'center': 'grid-center', 'right': 'grid-right'}[_vm.align] || 'center']},_vm._l((_vm.data),function(item,index){return _c('div',{key:index,staticClass:\"grid-item\",class:[{ 'small': 'grid-item__small', 'normal': 'grid-item__normal', 'large': 'grid-item__large'}[_vm.size] || 'normal', _vm.showname ? 'grid-item__showname' : '' ]},[_c('div',{staticClass:\"grid-item__img\",style:({backgroundImage: 'url(' + item.src + ')'})}),_c('div',{staticClass:\"grid-item__container\"},[_c('h2',[_vm._v(_vm._s(item.name))])])])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"lucky-image-grid\">\r\n    <div class=\"grid\"\r\n      :class=\"[{ 'left': 'grid-left', 'center': 'grid-center', 'right': 'grid-right'}[align] || 'center']\">\r\n      <div class=\"grid-item\" \r\n        v-for=\"(item, index) in data\" \r\n        :class=\"[{ 'small': 'grid-item__small', 'normal': 'grid-item__normal', 'large': 'grid-item__large'}[size] || 'normal', showname ? 'grid-item__showname' : '' ]\" \r\n        :key=\"index\">\r\n        <div class=\"grid-item__img\" :style=\"{backgroundImage: 'url(' + item.src + ')'}\"></div>\r\n        <div class=\"grid-item__container\">\r\n          <h2>{{item.name}}</h2>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"LuckyImageGrid\",\r\n  props: {\r\n    data: {\r\n      type: Array,\r\n      default: function () {\r\n        return []\r\n      }\r\n    },\r\n    align: {\r\n      type: String,\r\n      default: 'center',\r\n      validator (type) {\r\n        return ['left', 'center', 'right'].indexOf(type) > -1\r\n      }\r\n    },\r\n    size: {\r\n      type: String,\r\n      default: 'normal',\r\n      validator (size) {\r\n        return ['normal', 'small', 'large'].indexOf(size) > -1\r\n      }\r\n    },\r\n    showname: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@normalGridItemWidth: 60px;\r\n@normalGridItemHeight: 60px;\r\n\r\n.lucky-image-bed {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.grid {\r\n  display: flex;\r\n  max-width: 100%;\r\n  height: auto;\r\n  margin: 0 auto;\r\n  flex-direction: row;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n  align-items: flex-start;\r\n  transition: all .5s;\r\n\r\n  &-left {\r\n    justify-content: left;\r\n  }\r\n  &-center {\r\n    justify-content: center;\r\n  }\r\n  &-right {\r\n    justify-content: right;\r\n  }\r\n\r\n  .grid-item {\r\n    position: relative;\r\n    width: @normalGridItemWidth;\r\n    height: @normalGridItemHeight;\r\n    margin: 5px;\r\n\r\n    &__small {\r\n      width: calc(@normalGridItemWidth * 2 / 3);\r\n      height: calc(@normalGridItemHeight * 2 / 3);\r\n      \r\n      .grid-item__img {\r\n        max-width: calc(@normalGridItemWidth * 2 / 3);\r\n      }\r\n    }\r\n\r\n    &__large {\r\n      width: calc(@normalGridItemWidth * 1.5);\r\n      height: calc(@normalGridItemHeight * 1.5);\r\n\r\n      .grid-item__img {\r\n        max-width: calc(@normalGridItemWidth * 1.5);\r\n      }\r\n    }\r\n\r\n    &__img {\r\n      position: absolute;\r\n      top: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n\r\n      display: block;\r\n      margin: 0;\r\n      line-height: 0;\r\n      max-width: 100px;\r\n      height: auto;\r\n      background-size: cover;\r\n      background-repeat: no-repeat;\r\n      clip-path: circle(50% at center center);\r\n\r\n      &::before {\r\n        position: absolute;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        content: '';\r\n        opacity: 0;\r\n        transition: opacity 0.5s;\r\n        background: rgba(purple, .25);\r\n      }\r\n\r\n      &::after {\r\n        position: absolute;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        content: '';\r\n        opacity: 0;\r\n        transition: opacity 0.5s;\r\n        background: linear-gradient(to top, transparent, rgba(black, 0.5), transparent);\r\n      }\r\n    }\r\n\r\n    &__container {\r\n      position: absolute;\r\n      left: 50%;\r\n      top: 50%;\r\n      transform: translate(-50%, -50%) scale(.9);\r\n      width: 100%;\r\n      \r\n      font-weight: 400;\r\n      font-size: 10px;\r\n      color: #fff;\r\n      text-align: center;\r\n\r\n      opacity: 0;\r\n      will-change: transform;\r\n      backface-visibility: hidden;\r\n      transition: all .5s;\r\n\r\n      h2 {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\r\n      }\r\n    }\r\n\r\n    &:hover, &__showname {\r\n      .grid-item__container {\r\n        opacity: 1;\r\n        transform: translate(-50%, -50%) scale(1);\r\n      }\r\n\r\n      .grid-item__img {\r\n        &::before {\r\n          opacity: 1;\r\n        }\r\n        &::after {\r\n          opacity: 1;\r\n        }\r\n      }\r\n    }\r\n  } \r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-image-grid.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-image-grid.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./lucky-image-grid.vue?vue&type=template&id=ac904526&scoped=true&\"\nimport script from \"./lucky-image-grid.vue?vue&type=script&lang=js&\"\nexport * from \"./lucky-image-grid.vue?vue&type=script&lang=js&\"\nimport style0 from \"./lucky-image-grid.vue?vue&type=style&index=0&id=ac904526&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ac904526\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"lucky-register\"},[_c('img',{attrs:{\"src\":_vm.qrcodeBase64Data}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import QRCode from 'qrcode'\r\n\r\n/**\r\n * 生成二维码\r\n * @param {String} text\r\n */\r\nexport function generatorQRCode (text) {\r\n  return QRCode.toDataURL(text, {\r\n    type: 'svg',\r\n    margin: 0,\r\n    version: 6,\r\n    errorCorrectionLevel: 'H',\r\n    color: {\r\n      dark: '#000',\r\n      light: '#FFFFFF'\r\n    }\r\n  })\r\n}\r\n","<template>\r\n  <div class=\"lucky-register\">\r\n    <img :src=\"qrcodeBase64Data\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { generatorQRCode } from '@/utils/qrcode'\r\nexport default {\r\n  name: 'LuckyRegisterQrcode',\r\n  props: {\r\n    text: String\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      qrcodeBase64Data: ''\r\n    }\r\n  },\r\n\r\n  created () {\r\n    return generatorQRCode(this.text).then(base64Data => {\r\n      this.qrcodeBase64Data = base64Data\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .lucky-register {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0;\r\n    padding: 0;\r\n    img {\r\n      display: block;\r\n      width: 100%;\r\n      height: 100%;\r\n      margin: 0;\r\n      padding: 0;\r\n      line-height: 0;\r\n    }\r\n  }\r\n</style>\r\n\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-register-qrcode.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-register-qrcode.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./lucky-register-qrcode.vue?vue&type=template&id=66c7cc76&scoped=true&\"\nimport script from \"./lucky-register-qrcode.vue?vue&type=script&lang=js&\"\nexport * from \"./lucky-register-qrcode.vue?vue&type=script&lang=js&\"\nimport style0 from \"./lucky-register-qrcode.vue?vue&type=style&index=0&id=66c7cc76&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"66c7cc76\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"lucky-white-list\"},[_c('el-card',{attrs:{\"shadow\":\"always\"}},[_c('h5',{staticStyle:{\"padding\":\"0\",\"margin\":\"0\",\"color\":\"#BD2B24\",\"font-size\":\"26px\"}},[_vm._v(\" 签到表(\"+_vm._s(_vm.tableData.filter(function (item) { return _vm.list.includes(item.name.trim()); }).length)+\"/\"+_vm._s(_vm.tableData.filter(function (item) { return item.name.trim(); }).length)+\") \")]),_c('el-table',{staticClass:\"lucky-white-list__table\",staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.tableData,\"row-class-name\":_vm.tableRowClassName,\"empty-text\":\"签到表为空\"}},[_c('el-table-column',{attrs:{\"prop\":\"name\",\"label\":\"姓名\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.editable)?_c('el-input',{attrs:{\"autofucus\":\"true\",\"placeholder\":\"请输入姓名\"},model:{value:(scope.row.name),callback:function ($$v) {_vm.$set(scope.row, \"name\", $$v)},expression:\"scope.row.name\"}}):_c('span',{staticClass:\"user-name\",on:{\"dblclick\":function($event){scope.row.editable = true}}},[_vm._v(_vm._s(scope.row.name))])]}}])}),_c('el-table-column',{attrs:{\"prop\":\"status\",\"label\":\"状态\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(_vm.list.includes(scope.row.name.trim()))?_c('i',{staticClass:\"el-icon-circle-check\",attrs:{\"color\":\"green\"}}):_c('i',{staticClass:\"el-icon-circle-close\"}),_c('span',[_vm._v(_vm._s(_vm.list.includes(scope.row.name.trim()) ? '已签到' : '未签到'))])]}}])}),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":function($event){return _vm.edit(scope.$index, scope.row)}}},[_vm._v(_vm._s(scope.row.editable ? '确定' : '修改'))]),_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"weak\"},on:{\"click\":function($event){return _vm.deleteRow(scope.$index, scope.row)}}},[_vm._v(\"删除\")])]}}])})],1),_c('el-button',{staticStyle:{\"margin\":\"10px auto\"},attrs:{\"type\":\"primary\",\"icon\":\"el-icon-circle-plus-outline\"},on:{\"click\":_vm.addWhiteItem}},[_vm._v(\"添加\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/* eslint-disable new-cap */\r\n\r\n// 请求工具类\r\n\r\nimport axios from 'axios'\r\n\r\nconst axiosInstance = axios.create({\r\n  timeout: 5000,\r\n  withCredentials: true\r\n})\r\n\r\n// 请求返回的中间拦截, response: {data: Object, status: 200, statusText: \"OK\", headers: Object, config: Object, request: XMLHttpRequest }\r\naxiosInstance.interceptors.response.use(function (response) {\r\n  return response\r\n}, function (error) {\r\n  return Promise.reject(error)\r\n})\r\n\r\n// net 网络请求组件\r\nfunction net () {\r\n}\r\n\r\nnet.prototype.get = function (url, params) {\r\n  let _params = params || {}\r\n  return new Promise((resolve, reject) => {\r\n    return axiosInstance.get(url, {params: _params}).then(response => {\r\n      resolve(response.data)\r\n    }).catch(err => {\r\n      reject(err)\r\n    })\r\n  })\r\n}\r\n\r\nnet.prototype.post = function (url, params, config) {\r\n  let _params = params || {}\r\n  return new Promise((resolve, reject) => {\r\n    axiosInstance.post(url, _params, config).then(response => {\r\n      resolve(response.data)\r\n    }).catch(err => {\r\n      reject(err)\r\n    })\r\n  })\r\n}\r\n\r\nexport default new net()\r\n","import Net from '@/utils/net'\r\n\r\nfunction buildUrl(action) {\r\n  return '/api/' + action\r\n}\r\n\r\nfunction createWebsocket (url) {\r\n  if (window.WebSocket) {\r\n    return new window.WebSocket(url)\r\n  }\r\n  if (window.MozWebSocket) {\r\n    return new window.MozWebSocket(url)\r\n  }\r\n  return null\r\n}\r\n\r\nclass Api {\r\n\r\n  static register (name, avatar, session) {\r\n    let url = buildUrl('register')\r\n    return Net.post(url, { avatar, name, session })\r\n  }\r\n\r\n  /**\r\n   * @param {string} session\r\n   * @param {Function} onopenFn \r\n   * @param {Function} onmessgaeFn \r\n   * @param {*} oncloseFn \r\n   */\r\n  static syncUser (session, onopenFn, onmessgaeFn, oncloseFn) {\r\n    let host = window.location.host\r\n    let url = 'ws://' + host + '/syncUser?session=' + session\r\n    let websocket = createWebsocket(url)\r\n    if (websocket === null) {\r\n      throw Error('Browser dont support websocket')\r\n    }\r\n    websocket.onopen = function (evt) {\r\n      typeof onopenFn === 'function' && onopenFn(evt)\r\n    }\r\n\r\n    websocket.onmessage = function (evt) {\r\n      typeof onmessgaeFn === 'function' && onmessgaeFn(evt)\r\n    }\r\n\r\n    websocket.onclose = function (evt) {\r\n      typeof oncloseFn === 'function' && oncloseFn(evt)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取签到表\r\n   * @param {string} session \r\n   */\r\n  static checkinList (session) {\r\n    let url = buildUrl('checkinList')\r\n    return Net.post(url, { session })\r\n  }\r\n\r\n  /**\r\n   * 更新或者新增一个白名单\r\n   * @param {string} session \r\n   * @param {string[]} users 签到表姓名\r\n   */\r\n  static upsertCheckinList (session, users) {\r\n    let url = buildUrl('upsertCheckinList')\r\n    return Net.post(url, { session, users })\r\n  }\r\n\r\n  /**\r\n   * 提交一个新的抽奖会话\r\n   */\r\n  static upsertLuckSession ({ session, prizes, count, startTime, luckId }) {\r\n    const url = buildUrl('upsertLuckSession')\r\n    return Net.post(url, { session, prizes, count, startTime, luckId })\r\n  }\r\n\r\n  /**\r\n   * 删除一个抽奖会话\r\n   * @param {string} luckId \r\n   */\r\n  static deleteLuckSession (luckId) {\r\n    const url = buildUrl('deleteLuckSession')\r\n    return Net.post(url, { luckId })\r\n  }\r\n\r\n  /**\r\n   * 获取一个session的所有抽奖会话\r\n   */\r\n  static fetchLuckSessions (session) {\r\n    const url = buildUrl('getLucks')\r\n    return Net.get(url, { session })\r\n  }\r\n\r\n  static commitLuckyPeople ({ session, luckId, people }) {\r\n    const url = buildUrl('saveLuckyPeople')\r\n    return Net.post(url, { session, luckId, people })\r\n  }\r\n\r\n  /**\r\n   * 获取所有的参加抽奖的用户\r\n   * @param {string} session \r\n   */\r\n  static fetchUsers (session) {\r\n    const url = buildUrl(`sessions/${session}/users`)\r\n    return Net.get(url)\r\n  }\r\n}\r\n\r\n\r\nexport default Api\r\n","<template>\r\n  <div class=\"lucky-white-list\">\r\n    <el-card shadow=\"always\">\r\n      <h5 style=\"padding: 0; margin: 0; color: #BD2B24;font-size:26px;\">\r\n        签到表({{tableData.filter(item => list.includes(item.name.trim())).length}}/{{ tableData.filter(item => item.name.trim()).length }})\r\n      </h5>\r\n      <el-table \r\n        class=\"lucky-white-list__table\"\r\n        :data=\"tableData\"\r\n        :row-class-name=\"tableRowClassName\"\r\n        empty-text=\"签到表为空\"\r\n        style=\"width: 100%\">\r\n        <el-table-column prop=\"name\" label=\"姓名\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-input v-if=\"scope.row.editable\" autofucus=\"true\" v-model=\"scope.row.name\" placeholder=\"请输入姓名\" />\r\n            <span v-else class=\"user-name\" @dblclick=\"scope.row.editable = true\">{{ scope.row.name }}</span>            \r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <i color=\"green\" v-if=\"list.includes(scope.row.name.trim())\" class=\"el-icon-circle-check\"></i>\r\n            <i v-else class=\"el-icon-circle-close\"></i>\r\n            <span>{{ list.includes(scope.row.name.trim()) ? '已签到' : '未签到' }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"mini\" type=\"primary\" @click=\"edit(scope.$index, scope.row)\">{{ scope.row.editable ? '确定' : '修改' }}</el-button>\r\n            <el-button size=\"mini\" type=\"weak\" @click=\"deleteRow(scope.$index, scope.row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <el-button style=\"margin: 10px auto;\"\r\n        type=\"primary\" \r\n        icon=\"el-icon-circle-plus-outline\" \r\n        @click=\"addWhiteItem\">添加</el-button>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/* eslint-disable no-console */\r\n\r\nimport Api from '@/api'\r\nexport default {\r\n  name: 'LuckyWhiteList',\r\n  props: {\r\n    session: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    list: {\r\n      type: Array,\r\n      default: function () {\r\n        return []\r\n      }\r\n    }\r\n  },\r\n\r\n  data () {\r\n    return {\r\n      tableData: [],\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    'tableData': function (newVal, oldVal) {\r\n      this.notifyWhiteListChange()\r\n    }\r\n  },\r\n\r\n  created () {\r\n    this.loadCheckinList()\r\n  },\r\n\r\n  methods: {\r\n    tableRowClassName ({ row }) {\r\n      if (this.list.includes(row.name.trim())) {\r\n        return 'checkin-status__yes'\r\n      } else {\r\n        return 'checkin-status__no'\r\n      }\r\n    },\r\n\r\n    addWhiteItem () {\r\n      this.tableData.push({\r\n        name: '',\r\n        editable: true\r\n      })\r\n    },\r\n\r\n    notifyWhiteListChange () {\r\n      this.$emit('changed', this.tableData)\r\n    },\r\n\r\n    edit (index, row) {\r\n      row.editable = !row.editable\r\n      if (!row.editable) {\r\n        this.notifyWhiteListChange()\r\n        this.saveCheckinList()\r\n      }\r\n    },\r\n\r\n    deleteRow (index) {\r\n      this.tableData.splice(index, 1)\r\n      this.saveCheckinList()\r\n    },\r\n\r\n    saveCheckinList () {\r\n      let whiteListNames = []\r\n      this.tableData.forEach(item => whiteListNames.push(item.name))\r\n      \r\n      Api.upsertCheckinList(this.session, whiteListNames).then(response => {\r\n        if (response.code === 0) {\r\n          this.$message({ message: '签到表更新成功', type: 'success' })\r\n        } else {\r\n          this.$message({ message: '签到表更新失败', type: 'error' })\r\n        }\r\n      })\r\n    },\r\n\r\n    loadCheckinList () {\r\n      Api.checkinList(this.session).then(response => {\r\n        if (response.code === 0) {\r\n          let checkinList = response.data\r\n          checkinList.forEach(name => this.tableData.push({ name: name, editable: false }) )\r\n        } else {\r\n          console.error('Api.checkinList error: ', response.message)\r\n        }\r\n      }).catch(err => {\r\n        console.error('Api.checkinList error: ', err)\r\n        this.$message({ message: '签到表拉取失败', type: 'error' })\r\n      })\r\n    }\r\n\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"less\" scoped>\r\n  .lucky-white-list {\r\n    transition: transform .3s ease-in-out;\r\n    transition-delay: 0;\r\n    width: 80%;\r\n    height: 90%;\r\n    margin: 0 auto;\r\n    overflow: auto;\r\n    text-align: center;\r\n    will-change: transform;\r\n    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;\r\n    border-radius: 10px !important;\r\n  }\r\n</style>\r\n\r\n\r\n<style lang=\"less\">\r\n  @mainColor: #BD2B24;\r\n  @negitiveColor: #42D4DB;\r\n  .lucky-white-list {\r\n    color: @mainColor;\r\n\r\n    .el-button--primary {\r\n      background-color: @mainColor;\r\n      border-color: @mainColor;\r\n    }\r\n\r\n    .el-button--weak {\r\n      &:hover {\r\n        color: @mainColor;\r\n        background-color: #fff;\r\n        border-color: @mainColor;\r\n      }\r\n    }\r\n\r\n    .el-table .cell {\r\n      color: @mainColor;\r\n    }\r\n\r\n    .el-input__inner {\r\n      height: 30px;\r\n      line-height: 30px;\r\n      border-color: @mainColor;\r\n      color: @mainColor;\r\n    }\r\n\r\n    .el-table td {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .el-table th.is-leaf {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .user-name {\r\n      display: inline-block;\r\n      width: 100%;\r\n      height: 30px;\r\n      line-height: 30px;\r\n    }\r\n\r\n    .checkin-status__no {\r\n    }\r\n\r\n    .checkin-status__yes {\r\n      background-color: rgba(66,212,219,.2);\r\n    }\r\n  }\r\n \r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-white-list.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-white-list.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./lucky-white-list.vue?vue&type=template&id=13242f13&scoped=true&\"\nimport script from \"./lucky-white-list.vue?vue&type=script&lang=js&\"\nexport * from \"./lucky-white-list.vue?vue&type=script&lang=js&\"\nimport style0 from \"./lucky-white-list.vue?vue&type=style&index=0&id=13242f13&lang=less&scoped=true&\"\nimport style1 from \"./lucky-white-list.vue?vue&type=style&index=1&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"13242f13\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"lucky-people-display\"},[_c('span',{staticClass:\"lucky-people-display__title\"},[_vm._v(\"中奖名单\")]),_c('div',{staticClass:\"grid\"},_vm._l((_vm.data),function(people,index){return _c('div',{key:index,staticClass:\"grid-item\"},[_c('div',{staticClass:\"grid-item__avatar\",style:({backgroundImage: ['url(', people.src ,')'].join('')})}),_c('span',{staticClass:\"grid-item__name\"},[_vm._v(_vm._s(people.name))])])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"lucky-people-display\">\r\n    <span class=\"lucky-people-display__title\">中奖名单</span>\r\n    <div class=\"grid\">\r\n      <div class=\"grid-item\"\r\n        v-for=\"(people, index) in data\" :key=\"index\">\r\n        <div class=\"grid-item__avatar\" :style=\"{backgroundImage: ['url(', people.src ,')'].join('')}\"></div>\r\n        <span class=\"grid-item__name\">{{people.name}}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'LuckyPeopleDisplay',\r\n  props: {\r\n    data: {\r\n      type: Array,\r\n      default: function () {\r\n        return []\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.lucky-people-display {\r\n  position: relative;\r\n  width: 100%;\r\n  height: auto;\r\n\r\n  &__title {\r\n    display: block;\r\n    width: 100%;\r\n    font-size: 40px;\r\n    color: #FFF2A7;\r\n    text-align: center;\r\n  }\r\n\r\n  .grid {\r\n    display: flex;\r\n    max-width: 100%;\r\n    height: auto;\r\n    max-height: 100%;\r\n    margin: 0 auto;\r\n    flex-direction: row;\r\n    flex-wrap: wrap;\r\n    justify-content: center;\r\n    align-items: flex-start;\r\n    transition: all .5s;\r\n    overflow: auto;\r\n  }\r\n\r\n  .grid-item {\r\n    display: block;\r\n    width: 136px;\r\n    height: 181px;\r\n    overflow: hidden;\r\n    margin: 25px;\r\n\r\n    &__avatar {\r\n      width: 136px;\r\n      height: 136px;\r\n      clip-path: circle(50%);\r\n      border-radius: 50%;\r\n      background-size: cover;\r\n      background-repeat: no-repeat;\r\n    }\r\n\r\n    &__name {\r\n      display: block;\r\n      width: 100%;\r\n      height: 33px;\r\n      margin-top: 12px;\r\n      line-height: 33px;\r\n      font-size: 24px;\r\n      color: #FFF2A7;\r\n      text-align: center;\r\n      font-weight: 600;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-people-display.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-people-display.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./lucky-people-display.vue?vue&type=template&id=68a505ad&scoped=true&\"\nimport script from \"./lucky-people-display.vue?vue&type=script&lang=js&\"\nexport * from \"./lucky-people-display.vue?vue&type=script&lang=js&\"\nimport style0 from \"./lucky-people-display.vue?vue&type=style&index=0&id=68a505ad&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"68a505ad\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"luck-board\"},[_vm._m(0),_c('div',{staticClass:\"luck-board-sessions\"},[_c('el-table',{staticClass:\"luck-board-table\",attrs:{\"data\":_vm.sessionsData,\"empty-text\":\"还没有创建抽奖会话\"}},[_vm._l((_vm.sessionsSchema),function(session,index){return _c('el-table-column',{key:index,attrs:{\"label\":session.label,\"prop\":session.prop,\"formatter\":session.formatter}})}),_c('el-table-column',{attrs:{\"label\":\"操作\",\"align\":\"center\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":function($event){return _vm.edit(scope.$index, scope.row)}}},[_vm._v(\"修改\")]),_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"weak\"},on:{\"click\":function($event){return _vm.deleteRow(scope.$index, scope.row)}}},[_vm._v(\"删除\")])]}}])})],2)],1),(_vm.showCreateButton)?_c('el-button',{staticStyle:{\"position\":\"absolute\",\"top\":\"0\",\"right\":\"30px\",\"margin-top\":\"20px\"},attrs:{\"type\":\"primary\",\"size\":\"small\"},on:{\"click\":_vm.toggleLuckSessionForm}},[_vm._v(\" 添加新的抽奖 \")]):_vm._e(),_c('el-dialog',{attrs:{\"title\":\"创建新的抽奖\",\"modal-append-to-body\":false,\"before-close\":_vm.toggleLuckSessionForm,\"visible\":_vm.formVisible},on:{\"update:visible\":function($event){_vm.formVisible=$event}}},[_c('el-form',{ref:\"formRef\",staticClass:\"form-new-session\",attrs:{\"model\":_vm.sessionForm}},[_c('el-form-item',{attrs:{\"label\":\"奖品描述\"}},[_c('el-input',{model:{value:(_vm.sessionForm.prizes),callback:function ($$v) {_vm.$set(_vm.sessionForm, \"prizes\", $$v)},expression:\"sessionForm.prizes\"}})],1),_c('el-form-item',{attrs:{\"label\":\"奖品数量\"}},[_c('el-input',{model:{value:(_vm.sessionForm.count),callback:function ($$v) {_vm.$set(_vm.sessionForm, \"count\", _vm._n($$v))},expression:\"sessionForm.count\"}})],1),_c('el-form-item',{attrs:{\"label\":\"开始时间\"}},[_c('el-time-picker',{staticStyle:{\"width\":\"100%\"},attrs:{\"type\":\"datetime\",\"value-format\":\"timestamp\"},model:{value:(_vm.sessionForm.startTime),callback:function ($$v) {_vm.$set(_vm.sessionForm, \"startTime\", $$v)},expression:\"sessionForm.startTime\"}})],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.upsertLuckSession}},[_vm._v(\" \"+_vm._s(_vm.sessionForm.luckId ? '更新' : '创建')+\" \")]),_c('el-button',{on:{\"click\":_vm.cancel}},[_vm._v(\"取消\")])],1)],1)],1)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"luck-board-title\"},[_c('span',[_vm._v(\"抽奖会话列表\")])])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"luck-board\">\r\n    <div class=\"luck-board-title\">\r\n      <span>抽奖会话列表</span>\r\n    </div>\r\n\r\n    <div class=\"luck-board-sessions\">\r\n      <el-table \r\n        class=\"luck-board-table\"\r\n        :data=\"sessionsData\"\r\n        empty-text=\"还没有创建抽奖会话\"\r\n      >\r\n        <el-table-column \r\n          v-for=\"(session, index) in sessionsSchema\" \r\n          :key=\"index\"\r\n          :label=\"session.label\"\r\n          :prop=\"session.prop\"\r\n          :formatter=\"session.formatter\"\r\n        />\r\n        <el-table-column label=\"操作\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button size=\"mini\" type=\"primary\" @click=\"edit(scope.$index, scope.row)\">修改</el-button>\r\n            <el-button size=\"mini\" type=\"weak\" @click=\"deleteRow(scope.$index, scope.row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n\r\n    <el-button \r\n      v-if=\"showCreateButton\"\r\n      type=\"primary\"\r\n      size=\"small\"\r\n      style=\"position: absolute; top: 0;right: 30px;margin-top: 20px;\"\r\n      @click=\"toggleLuckSessionForm\"\r\n    >\r\n      添加新的抽奖\r\n    </el-button>\r\n\r\n    <el-dialog \r\n      title=\"创建新的抽奖\"\r\n      :modal-append-to-body=\"false\"\r\n      :before-close=\"toggleLuckSessionForm\"\r\n      :visible.sync=\"formVisible\"\r\n    >\r\n      <el-form \r\n        class=\"form-new-session\"\r\n        :model=\"sessionForm\"\r\n        ref=\"formRef\"\r\n      >\r\n        <el-form-item label=\"奖品描述\">\r\n          <el-input v-model=\"sessionForm.prizes\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"奖品数量\">\r\n          <el-input v-model.number=\"sessionForm.count\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"开始时间\">\r\n          <el-time-picker \r\n            style=\"width: 100%\"\r\n            v-model=\"sessionForm.startTime\"\r\n            type=\"datetime\"\r\n            value-format=\"timestamp\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button \r\n            type=\"primary\"\r\n            @click=\"upsertLuckSession\"\r\n          >\r\n          {{ sessionForm.luckId ? '更新' : '创建' }}\r\n          </el-button>\r\n          <el-button @click=\"cancel\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Api from '../../api'\r\n\r\nexport default {\r\n  name: 'LuckBoard',\r\n  props: {\r\n    showCreateButton: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      luckyPeople: [],\r\n      sessionsData: [\r\n      ],\r\n      sessionsSchema: [\r\n        { label: '奖品描述', prop: 'prizes', },\r\n        { label: '奖品数量', prop: 'count', },\r\n        { \r\n          label: '抽奖时间', \r\n          prop: 'startTime',\r\n          formatter: (row, col, val) => {\r\n            let dd = new Date(val)\r\n            return [dd.getFullYear(), dd.getMonth()+1, dd.getDate()].join('/') + '  ' + [dd.getHours(), dd.getMinutes(), dd.getSeconds()].join(':')\r\n          }\r\n        },\r\n        { \r\n          label: '中奖人员', \r\n          formatter: (row, col, val) => {\r\n            let luckId = row.luckId\r\n            let lp = this.luckyPeople.find(lp => lp.luckId === luckId)\r\n            return lp ? lp.users.join(',') : '-'\r\n          }\r\n        },\r\n        { \r\n          label: '抽奖会话状态', \r\n          prop: 'startTime', \r\n          formatter: (row, col, val) => {\r\n            let finished = row.finished\r\n            if (finished) {\r\n              return '已结束'\r\n            }\r\n            return val === this.currentLuckSession.startTime ? '进行中' : '未开始'\r\n          }\r\n        }\r\n      ],\r\n\r\n      formVisible: false,\r\n      sessionForm: {\r\n        prizes: '',\r\n        count: '',\r\n        startTime: ''\r\n      },\r\n      session: this.$route.query.session\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    currentLuckSession () {\r\n      const sessions = this.sessionsData.filter(s => !s.finished)\r\n      sessions.sort((a, b) => a.startTime - b.startTime)\r\n      return sessions[0]\r\n    }\r\n  },\r\n\r\n  created () {\r\n    if (!this.session) {\r\n      this.$message.error('URL中请指定session')\r\n    } else {\r\n      this.requestLuckSessions()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n\r\n    edit (index, row) {\r\n      if (row.finished) {\r\n        return this.$message.error(\"禁止修改已结束的抽奖\")\r\n      }\r\n\r\n      this.toggleLuckSessionForm()\r\n      this.sessionForm = row\r\n      Api.upsertLuckSession(this.sessionForm).then(res => {\r\n        if (res.code === 0) {\r\n          this.$message.success('修改成功')\r\n          this.requestLuckSessions()\r\n\r\n        } else {\r\n          this.$message.error(res.message || '修改失败')\r\n        }\r\n\r\n      }).catch(err => {\r\n        this.$message.error(err || '修改失败')\r\n      })\r\n    },\r\n\r\n    deleteRow (index, row) {\r\n      if (row.finished) {\r\n        return this.$message.error(\"禁止删除已结束的抽奖\")\r\n      }\r\n      Api.deleteLuckSession(row.luckId).then(res => {\r\n        if (res.code === 0) {\r\n          this.$message.success('删除成功')\r\n          this.requestLuckSessions()\r\n        } else {\r\n          this.$message.error(res.message || '删除失败')\r\n        }\r\n\r\n      }).catch(err => {\r\n        this.$message.error(err || '删除失败')\r\n      })\r\n\r\n    },\r\n\r\n    // 打开创建抽奖会话的form表单\r\n    toggleLuckSessionForm () {\r\n      this.formVisible = !this.formVisible\r\n      if (!this.formVisible) { // 关闭，则清空sessionForm\r\n        this.sessionForm = {\r\n          prizes: '',\r\n          count: '',\r\n          startTime: ''\r\n        }\r\n      }\r\n    },\r\n\r\n    requestLuckSessions () {\r\n      Api.fetchLuckSessions(this.session).then(res => {\r\n        if (res.code === 0) {\r\n          this.sessionsData = res.data.luckSessions\r\n          this.luckyPeople = res.data.luckyPeople\r\n          this.emitCurrentLuckSession()\r\n        }\r\n\r\n        // 每2秒拉一次数据\r\n        setTimeout(this.requestLuckSessions.bind(this), 2000)\r\n      }).catch(err => {\r\n        // 每3秒拉一次数据\r\n        setTimeout(this.requestLuckSessions.bind(this), 3000)\r\n      })\r\n    },\r\n\r\n    // 添加新的抽奖\r\n    upsertLuckSession () {\r\n      if (!this.sessionForm.prizes || !this.sessionForm.count || !this.sessionForm.startTime) {\r\n        return this.$message.error('请填写合法的表单')\r\n      }\r\n      Api.upsertLuckSession({\r\n        session: this.session,\r\n        prizes: this.sessionForm.prizes,\r\n        count: this.sessionForm.count,\r\n        startTime: this.sessionForm.startTime,\r\n        luckId: this.sessionForm.luckId\r\n      }).then(res => {\r\n        if (res.code === 0) {\r\n          this.$message.success(this.sessionForm.luckId ? '修改成功' : '创建成功')\r\n          this.requestLuckSessions()\r\n        }\r\n      }).catch(err => {\r\n        this.$message.error(err.message)\r\n      })\r\n    },\r\n\r\n    emitCurrentLuckSession () {\r\n      this.$emit('change', this.currentLuckSession)\r\n    },\r\n\r\n    cancel () {\r\n      this.$refs['formRef'].resetFields()\r\n      this.toggleLuckSessionForm()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"less\" scoped>\r\n.luck-board {\r\n  transition: transform .3s ease-in-out;\r\n  transition-delay: 0;\r\n  background: #fff;\r\n  overflow-y: auto;\r\n  will-change: transform;\r\n  padding: 30px;\r\n  box-sizing: border-box;\r\n  box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;\r\n  border-radius: 10px;\r\n\r\n  &-title {\r\n    font-size: 26px;\r\n    font-weight: 600;\r\n    color: rgb(189,43,36);\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n<style lang=\"less\">\r\n  @mainColor: #BD2B24;\r\n  @negitiveColor: #42D4DB;\r\n  .luck-board {\r\n    color: @mainColor;\r\n\r\n    .el-button--primary {\r\n      background-color: @mainColor;\r\n      border-color: @mainColor;\r\n    }\r\n\r\n    .el-button--weak {\r\n      &:hover {\r\n        color: @mainColor;\r\n        background-color: #fff;\r\n        border-color: @mainColor;\r\n      }\r\n    }\r\n\r\n    .el-table .cell {\r\n      color: @mainColor;\r\n    }\r\n\r\n    .el-input__inner {\r\n      height: 30px;\r\n      line-height: 30px;\r\n      border-color: @mainColor;\r\n      color: @mainColor;\r\n    }\r\n\r\n    .el-table td {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .el-table th.is-leaf {\r\n      padding: 5px 0;\r\n    }\r\n\r\n    .user-name {\r\n      display: inline-block;\r\n      width: 100%;\r\n      height: 30px;\r\n      line-height: 30px;\r\n    }\r\n\r\n    .checkin-status__no {\r\n    }\r\n\r\n    .checkin-status__yes {\r\n      background-color: rgba(66,212,219,.2);\r\n    }\r\n  }\r\n \r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./luck-board.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./luck-board.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./luck-board.vue?vue&type=template&id=53640355&scoped=true&\"\nimport script from \"./luck-board.vue?vue&type=script&lang=js&\"\nexport * from \"./luck-board.vue?vue&type=script&lang=js&\"\nimport style0 from \"./luck-board.vue?vue&type=style&index=0&id=53640355&lang=less&scoped=true&\"\nimport style1 from \"./luck-board.vue?vue&type=style&index=1&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"53640355\",\n  null\n  \n)\n\nexport default component.exports","import { Random } from 'random-js'\r\n\r\nexport function integerRangeRandom () {\r\n  let engine =  new Random()\r\n  return function (minInteger, maxInteger) {\r\n    return engine.integer(minInteger, maxInteger)\r\n  }\r\n}\r\n","<template>\r\n  <div class=\"luckydraw\" :class=\"[context.state === context.S_CONFIRM ? 'luckydraw-confirming' : '']\">\r\n    <!-- title -->\r\n    <h2 class=\"title\"><span style=\"color: #fcea00;\">2021</span>新年联欢，抽奖现场</h2>\r\n\r\n    <el-row style=\"position: absolute; top: 170px; left: 0; right: 0; bottom: 0;\">\r\n      <!-- 签到成功展示区域 -->\r\n      <el-col :span=\"6\" class=\"luckydraw-participant\">\r\n        <h4 class=\"luckydraw-participant__title\">\r\n          可参与抽奖人数({{validParticipantList.length}})\r\n        </h4>\r\n        <lucky-image-grid class=\"luckydraw-participant__wrapper\"\r\n          :data=\"validParticipantList\">\r\n        </lucky-image-grid>\r\n      </el-col>\r\n\r\n      <!-- 抽奖 & 中奖结果 展示区域 -->\r\n      <el-col class=\"luckydraw-main\"\r\n        :span=\"12\">\r\n          <el-button class=\"luckydraw-main__button luckydraw-main__start\" \r\n            v-if=\"context.state === context.S_START\"\r\n            size=\"large\"\r\n            :round=\"true\"\r\n            type=\"primary\" \r\n            @click=\"onDrawButtonClick(context.S_START)\">\r\n          </el-button>\r\n          <el-button class=\"luckydraw-main__button luckydraw-main__drawing\" \r\n            v-if=\"context.state === context.S_DRAWING\"\r\n            size=\"large\"\r\n            :round=\"true\"\r\n            type=\"primary\" \r\n            @click=\"onDrawButtonClick(context.S_DRAWING)\">\r\n          </el-button>\r\n          \r\n          <el-row class=\"luckydraw-main__confirm\"\r\n            v-if=\"context.state === context.S_CONFIRM\">\r\n            <el-col :span=\"12\">\r\n              <el-button class=\"luckydraw-main__button luckydraw-main__confirm-yes\"\r\n                :round=\"true\"\r\n                type=\"primary\"\r\n                @click=\"onConfirmYesButtonClick\">抽奖有效</el-button>\r\n            </el-col>\r\n            <el-col :span=\"12\">\r\n              <el-button class=\"luckydraw-main__button luckydraw-main__confirm-no\"\r\n                type=\"weak\"\r\n                :round=\"true\"\r\n                @click=\"toStartState\">抽奖无效</el-button>\r\n            </el-col>\r\n          </el-row>\r\n\r\n          <el-input class=\"luckydraw-main__count-input\" \r\n            v-model.number=\"context.numLuckyPeople\" \r\n            placeholder=\"中奖人数\" \r\n            :max=\"validParticipantList.length\" \r\n            :min=\"0\"\r\n            :disabled=\"true\"\r\n            @input=\"onCountInputChange\"/>\r\n          \r\n          <div class=\"luckydraw-main__hrl\"\r\n            v-if=\"context.state === context.S_START || context.state === context.S_DRAWING\">\r\n            <div class=\"luckydraw-main__hrl-viewport\">\r\n              <div class=\"img-bg\"\r\n                v-show=\"context.state === context.S_DRAWING\"\r\n                v-for=\"(img, index) in randomParticipantList\" \r\n                :key=\"index\" \r\n                :style=\"{backgroundImage: 'url(' + img.src + ')', zIndex: index === (context.randomIndex % randomParticipantList.length) ? '1' : '0'}\">\r\n              </div>\r\n            </div>\r\n            <span v-show=\"context.randomIndex > -1\">\r\n              {{ randomParticipantList[context.randomIndex % randomParticipantList.length] && randomParticipantList[context.randomIndex % randomParticipantList.length].name}}\r\n            </span>\r\n          </div>\r\n          <lucky-people-display class=\"luckydraw-main__lpd\"\r\n            v-else\r\n            :data=\"context.luckyPeople\">\r\n          </lucky-people-display>\r\n      </el-col>\r\n\r\n      <!-- 已中奖展示区域 -->\r\n      <el-col class=\"luckydraw-forbidden\"\r\n        :span=\"6\">\r\n        <h4 class=\"luckydraw-forbidden__title\">已中奖人数({{forbiddenParticipantList.length}})</h4>\r\n        <lucky-image-grid :data=\"forbiddenParticipantList\" class=\"luckydraw-forbidden__wrapper\"></lucky-image-grid>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 签到二维码 -->\r\n    <div class=\"lucky-register-qrcode\">\r\n      <lucky-register-qrcode :text=\"qrCodeContent\"></lucky-register-qrcode>\r\n    </div>\r\n\r\n    <!-- 签到表 -->\r\n    <div class=\"lucky-checkin\">\r\n      <a class=\"lucky-checkin-button\" href=\"javascript: void 0;\" @click=\"toggleWhiteList\"></a>\r\n      <lucky-white-list\r\n        :list=\"participantNameList\"\r\n        :session=\"session\"  \r\n        :style=\"{transform: whiteListVisible ? 'scale(1)' : 'scale(0)', marginTop: '60px'}\"\r\n        @changed=\"onWhiteListChanged\">\r\n      </lucky-white-list>\r\n    </div>\r\n\r\n    <!-- 增加抽奖会话 -->\r\n    <div class=\"luck-session\">\r\n      <a \r\n        class=\"luck-session-button\" \r\n        href=\"javascript: void 0;\" \r\n        @click=\"toggleLuckSessionVisible\"\r\n      >\r\n        抽奖会话\r\n      </a>\r\n      <luck-board\r\n        class=\"luck-board\"\r\n        :style=\"{transform: luckSessionVisible ? 'scale(1)' : 'scale(0)', marginTop: '60px' }\"\r\n        @change=\"onLuckSessionChange\"\r\n      />\r\n    </div>\r\n\r\n  </div>  \r\n</template>\r\n\r\n<script>\r\nimport LuckyImageGrid from '@/components/lucky-image-grid/lucky-image-grid'\r\nimport LuckyRegisterQrcode from '@/components/lucky-register-qrcode/lucky-register-qrcode'\r\nimport LuckyWhiteList from '@/components/lucky-white-list/lucky-white-list'\r\nimport LuckyPeopleDisplay from '@/components/lucky-people-display/lucky-people-display'\r\nimport LuckBoard from '@/components/luck-board/luck-board'\r\n\r\nimport { integerRangeRandom } from '@/utils/math'\r\n\r\nconst randomGenerator = integerRangeRandom()\r\n\r\nimport Api from '@/api'\r\n\r\nexport default {\r\n  components: {\r\n    LuckyImageGrid,\r\n    LuckyRegisterQrcode,\r\n    LuckyWhiteList,\r\n    LuckyPeopleDisplay,\r\n    LuckBoard\r\n  },\r\n  data () {\r\n    LuckBoard\r\n    return {\r\n      participantList: [\r\n        {session: '2021', name: '张云峰', src: 'https://cdn.dribbble.com/users/2076798/screenshots/14007967/media/22cd0a660328ff5593cecdb58491c770.jpg?compress=1&resize=400x300', forbidden: false },\r\n        {session: '2021', name: '张三', src: 'https://cdn.dribbble.com/users/2076798/screenshots/14007967/media/22cd0a660328ff5593cecdb58491c770.jpg?compress=1&resize=400x300', forbidden: false },\r\n        {session: '2021', name: '张云峰2', src: 'https://cdn.dribbble.com/users/2076798/screenshots/14007967/media/22cd0a660328ff5593cecdb58491c770.jpg?compress=1&resize=400x300', forbidden: false },\r\n        {session: '2021', name: '张三2', src: 'https://cdn.dribbble.com/users/2076798/screenshots/14007967/media/22cd0a660328ff5593cecdb58491c770.jpg?compress=1&resize=400x300', forbidden: false }\r\n      ], // 所有的参与者\r\n      session: '',\r\n      whiteListVisible: false,\r\n      whiteList: [], // only save name\r\n\r\n      context: {\r\n        S_START: 'start',\r\n        S_DRAWING: 'drawing',\r\n        S_CONFIRM: 'confirm',\r\n        numLuckyPeople: 0,\r\n        state: 'start', // 抽奖状态: start, drawing, confirm,  start => drawing => confirm => start\r\n        randomIndex: -1,\r\n        luckyPeople: [],\r\n        proposalLuckyPeopleIndexes: []\r\n      },\r\n\r\n      luckSessionVisible: false,\r\n      currentLuckSession: {}\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    qrCodeContent () {\r\n      let validInteger  = str => !(Number.parseInt(str).toString() === 'NaN')\r\n\r\n      let interval = this.$route.query.interval || ''  // unit: minute\r\n      let protocol = window.location.protocol // http:  https:\r\n      let host = window.location.host // localhost:8081\r\n\r\n      let registerUrl = `${protocol}//${host}/register?session=${this.session}`\r\n      if (interval && validInteger(interval)) {\r\n        registerUrl = `${registerUrl}&interval=${interval}`\r\n      }\r\n      return registerUrl\r\n    },\r\n\r\n    randomParticipantList () {\r\n      let maxLength = Math.min(20, this.validParticipantList.length)\r\n      return this.validParticipantList.slice(0, maxLength)\r\n    },\r\n\r\n    validParticipantList () { // 可以抽奖的人，签到并且还没有中奖\r\n      return this.checkedParticipantList.filter(item => !item.forbidden)\r\n    },\r\n\r\n    forbiddenParticipantList () { // 被禁止的人（抽过奖的也会被禁止)\r\n      return this.checkedParticipantList.filter(item => item.forbidden)\r\n    },\r\n\r\n    checkedParticipantList () { // 签到的人\r\n      return this.participantList.filter(item => {\r\n        return this.whiteList.indexOf(item.name.trim()) > -1\r\n      })\r\n    },\r\n\r\n    participantNameList () {\r\n      return this.participantList.map(item => item.name)\r\n    }\r\n  },\r\n\r\n  created () {\r\n    this.session = this.$route.query.session || '' + Date.now()    \r\n  },\r\n\r\n  mounted () {\r\n    Api.syncUser(this.session, this.onWebSocketOpen.bind(this), this.onWebSocketMessage.bind(this), this.onWebSocketClose.bind(this))\r\n\r\n    // beforeClose\r\n    window.addEventListener('beforeunload', function (evt) {\r\n      evt = evt || window.event\r\n      if (evt) {\r\n        evt.returnValue = '确定离开抽奖页面吗？'\r\n      }\r\n      return '确定离开抽奖页面吗？'\r\n    })\r\n  },\r\n\r\n  methods: {\r\n    onWebSocketOpen () {\r\n      // eslint-disable-next-line no-console\r\n      console.log('onWebSocketOpen')\r\n    },\r\n\r\n    onWebSocketMessage (onMessageEvent) {\r\n      if (onMessageEvent.data.length <= 1) { // this is heart beat\r\n        // eslint-disable-next-line no-console\r\n        console.log('keep-alive heartbeat ', onMessageEvent.data)\r\n        return\r\n      }\r\n      let data = JSON.parse(onMessageEvent.data)\r\n      // eslint-disable-next-line no-console\r\n      console.log('onWebSocketMessage Data: ', onMessageEvent.data)\r\n      if (data.action === 'AllUsers') {\r\n        let forbiddenNames = this.loadLuckyNamesLocal()\r\n        this.participantList = data.data.map(item => {  \r\n          return { session: item.session, name: item.user.trim(), src: item.avatar, forbidden: forbiddenNames.indexOf(item.user.trim()) > -1 }\r\n        })\r\n      }\r\n\r\n      if (data.action === 'NewUser') {\r\n        let inChecinList = this.whiteList.includes(data.data.user.trim())\r\n        if (inChecinList) {\r\n          this.$message({ message: data.data.user + ' 签到成功', type: 'success' })\r\n        } else {\r\n          this.$message({ message: data.data.user + '(外部人员) 扫码加入', type: 'warning' })\r\n        }\r\n\r\n        this.participantList.splice(0, 0, {session: data.data.session, name: data.data.user, src: data.data.avatar, forbidden: false })\r\n      }\r\n    },\r\n\r\n    onWebSocketClose () {\r\n      // eslint-disable-next-line no-console\r\n      console.log('onWebSocketClose')\r\n    },\r\n    \r\n    toNextState () {\r\n      let stateMachine = {\r\n        'start': this.toDrawingState.bind(this),\r\n        'drawing': this.toConfrimState.bind(this),\r\n        'confirm': this.toStartState.bind(this)\r\n      }\r\n      stateMachine[this.context.state]()\r\n    },\r\n\r\n    // 抽奖初始状态\r\n    toStartState () {\r\n      this.context.state = this.context.S_START\r\n      this.context.numLuckyPeople =  1\r\n      this.context.randomIndex = -1\r\n      this.context.luckyPeople.splice(0, this.context.luckyPeople.length)\r\n      this.context.proposalLuckyPeopleIndexes.splice(0, this.context.proposalLuckyPeopleIndexes.length)\r\n    },\r\n\r\n    // 抽奖中\r\n    toDrawingState () {\r\n      this.context.state = this.context.S_DRAWING\r\n      if (this.validParticipantList.length <= 0 || this.context.numLuckyPeople < 1) {\r\n        return\r\n      }\r\n      this.startDrawing()\r\n    },\r\n\r\n    // 确定抽奖结果\r\n    toConfrimState () {\r\n      this.context.state = this.context.S_CONFIRM\r\n      this.context.proposalLuckyPeopleIndexes.forEach(value => {\r\n        setTimeout(() => {\r\n          this.context.luckyPeople.push(this.validParticipantList[value])\r\n        }, 500)\r\n      })\r\n    },\r\n\r\n    onDrawButtonClick () {\r\n      if (this.validParticipantList.length <= 0 || this.context.numLuckyPeople < 1) {\r\n        return\r\n      }\r\n      this.toNextState()\r\n    },\r\n\r\n    // 确定抽奖结果有效\r\n    onConfirmYesButtonClick () {\r\n      const luckyPeopleNames = []\r\n      // 中奖人 从参与抽奖人中移除， 加入到已中奖的栏中\r\n      this.context.luckyPeople.forEach((people) => {\r\n        luckyPeopleNames.push(people.name)\r\n\r\n        Array.from({length: this.participantList.length}).forEach((v, index) => {\r\n          let item = this.participantList[index]\r\n          if (item.name === people.name) {\r\n            item.forbidden = true\r\n            this.participantList.splice(index, 1, item)\r\n          }\r\n        })\r\n      })\r\n\r\n      // 保存抽奖的结果\r\n      if (luckyPeopleNames.length > 0) {\r\n        this.commitLuckyPeople(luckyPeopleNames)\r\n      }\r\n\r\n      // 本地存储中奖人姓名\r\n      this.saveLuckyNamesLocal()\r\n      this.toNextState()\r\n    },\r\n\r\n    startDrawing () {\r\n      requestAnimationFrame(() => {\r\n        let indexes = this.generateRandomIndexes(this.context.numLuckyPeople)\r\n        this.context.randomIndex = indexes[0] || 0\r\n\r\n        if (this.context.state !== this.context.S_DRAWING) { // 确保调用 startDrawing，至少能只执行一次抽奖逻辑\r\n          this.context.randomIndex = this.context.proposalLuckyPeopleIndexes[0] || 0\r\n          return \r\n        }\r\n        this.startDrawing()\r\n      })\r\n    },\r\n\r\n    generateRandomIndexes (numsIndexes) {\r\n      let length = this.validParticipantList.length\r\n      let cloneValidParticipantList = this._.cloneDeep(this.validParticipantList)\r\n      cloneValidParticipantList = cloneValidParticipantList.map((item, index) => { \r\n        item.index = index\r\n        return item\r\n      })\r\n\r\n      numsIndexes = Math.min(numsIndexes, length)\r\n      this.context.proposalLuckyPeopleIndexes.splice(0, this.context.proposalLuckyPeopleIndexes.length)\r\n\r\n      while (this.context.proposalLuckyPeopleIndexes.length < numsIndexes) {\r\n        let index = randomGenerator(0, cloneValidParticipantList.length-1)\r\n        this.context.proposalLuckyPeopleIndexes.push(cloneValidParticipantList[index].index)\r\n        cloneValidParticipantList.splice(index, 1)\r\n      }\r\n      return this.context.proposalLuckyPeopleIndexes\r\n    },\r\n\r\n    toggleWhiteList () {\r\n      // eslint-disable-next-line no-console\r\n      console.log('toggle white list')\r\n      this.whiteListVisible = !this.whiteListVisible\r\n      if (this.whiteListVisible) {\r\n        this.luckSessionVisible = false\r\n      }\r\n    },\r\n\r\n    onWhiteListChanged (list) {\r\n      // 增加/删除 签到人员，需要结合\r\n      this.whiteList.splice(0, this.whiteList.length)\r\n      list.map(val => val.name).forEach(name => this.whiteList.push(name))\r\n    },\r\n\r\n    onCountInputChange (count) {\r\n      if (count > this.validParticipantList.length) {\r\n        this.context.numLuckyPeople = this.validParticipantList.length\r\n      }\r\n      if (count < 1) {\r\n        this.context.numLuckyPeople = Math.min(1, this.validParticipantList.length)\r\n      }\r\n    },\r\n\r\n    saveLuckyNamesLocal () {\r\n      let forbiddentNames = this.forbiddenParticipantList.map(item => item.name) || []\r\n      let key = this.session + '-lucky-names'\r\n      localStorage.setItem(key, JSON.stringify(forbiddentNames))\r\n    },\r\n\r\n    loadLuckyNamesLocal () {\r\n      let key = this.session + '-lucky-names'\r\n      let forbiddenNamesStr = localStorage.getItem(key) || JSON.stringify([])\r\n      return JSON.parse(forbiddenNamesStr)\r\n    },\r\n\r\n\r\n    toggleLuckSessionVisible () {\r\n      this.luckSessionVisible = !this.luckSessionVisible\r\n      if (this.luckSessionVisible) {\r\n        this.whiteListVisible = false\r\n      }\r\n    },\r\n\r\n    onLuckSessionChange (luckSession) {\r\n      this.currentLuckSession = luckSession\r\n      this.context.numLuckyPeople = this.currentLuckSession ? this.currentLuckSession.count : 0\r\n    },\r\n\r\n    commitLuckyPeople (people) {\r\n      let session = this.currentLuckSession.session\r\n      let luckId = this.currentLuckSession.luckId\r\n      Api.commitLuckyPeople({ session, luckId, people }).then(res => {\r\n        if (res.code === 0) {\r\n          this.$message.success(\"中奖信息保存成功\")\r\n        } else {\r\n          this.$message.error(`中奖信息保存失败(${res.code})`)\r\n        }\r\n      })\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@mainColor: #990008;\r\n\r\n.luckydraw {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n\r\n  background-image: radial-gradient(50% 109%, #F95F4C 42%, #9E1010 100%);\r\n  border: 1px solid #979797;\r\n\r\n  &::before {\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    top: 0;\r\n    bottom: 0;\r\n    content: \"\";\r\n    background: url(\"~@/assets/bg-layer.png\") no-repeat;\r\n    background-position: 50% 0;\r\n  }\r\n\r\n  .title {\r\n    display: block;\r\n    height: 98px;\r\n    margin-bottom: 0;\r\n    margin-block-start: 40px;\r\n    padding: 0;\r\n    line-height: 98px;\r\n    font-size: 70px;\r\n    text-align: center;\r\n    color: #fff2a7;\r\n  }\r\n}\r\n\r\n.lucky-register-qrcode {\r\n  position: absolute;\r\n  left: 60px;\r\n  top: 30px;\r\n  width: 100px;\r\n  padding: 5px;\r\n  background: rgba(#fff, 1);\r\n  transition: all .5s;\r\n  transform: scale(1);\r\n  transform-origin: left top;\r\n  z-index: 100;\r\n\r\n  &:hover {\r\n    transform: scale(6);\r\n  }\r\n}\r\n\r\n.luckydraw-participant {\r\n  position: absolute;\r\n  left: 60px;\r\n  top: 0;\r\n  width: 462px;\r\n  height: 780px;\r\n  overflow: hidden;\r\n  box-sizing: border-box;\r\n  background-color: rgba(#000, .15);\r\n  border-radius: 10px;\r\n\r\n  transition: opacity .3s;\r\n  opacity: 1;\r\n\r\n  &__title {\r\n    text-align: center;\r\n    color: #fff2a7;\r\n    font-size: 30px;\r\n    font-weight: 400;\r\n    margin-block-start: 30px;\r\n    margin-block-end: 20px;\r\n  }\r\n  &__wrapper {\r\n    overflow: auto;\r\n    height: 670px;\r\n  }\r\n}\r\n\r\n.luckydraw-main {\r\n  position: absolute;\r\n  left: 50%;\r\n  height: 820px;\r\n  overflow: hidden;\r\n  text-align: center;\r\n  transform: translateX(-50%);\r\n\r\n  &__button {\r\n    width: 270px;\r\n    height: 64px;\r\n    margin-top: 0;\r\n    font-size: 36px;\r\n    border: none;\r\n    font-weight: 500;\r\n    padding: 0;\r\n    margin: 0;\r\n    border-radius: 0;\r\n  }\r\n\r\n  &__start {\r\n    background: url(\"~@/assets/start-draw-button.svg\") no-repeat;\r\n    background-size: 100% 100%;\r\n    color: #BD2B24;\r\n  }\r\n\r\n  &__drawing {\r\n    background: url(\"~@/assets/stop-draw-button.svg\") no-repeat;\r\n    background-size: 100% 100%;\r\n    color: #BD2B24;\r\n  }\r\n\r\n  &__confirm {\r\n    width: 270px;\r\n    margin: 0 auto;\r\n\r\n    &-yes {\r\n      width: 125px;\r\n      font-size: 18px;\r\n      border-radius: 60px;\r\n      background-color: #BD2B24;\r\n      border: 1px solid #BD2B24;\r\n      color: #fff2a7;\r\n      font-weight: 500;\r\n\r\n    }\r\n\r\n    &-no {\r\n      width: 125px;\r\n      font-size: 18px;\r\n      border-radius: 60px;\r\n      border: 1px solid #BD2B24;\r\n      color: #BD2b24;\r\n      font-weight: 500;\r\n    }\r\n    \r\n  }\r\n\r\n  /deep/ &__count-input {\r\n    border: none;\r\n    display: block;\r\n    width: 220px;\r\n    margin: 0 auto;\r\n    margin-top: 10px;\r\n    text-align: center;\r\n\r\n    > .el-input__inner {\r\n      border: none;\r\n      margin: 0;\r\n      padding: 0;\r\n      line-height: 30px;\r\n      height: 30px;\r\n      background-color: rgba(#000, 0);\r\n      border-radius: 0;\r\n      border-bottom: 2px solid #fff2a7;\r\n      text-align: center;\r\n      font-size: 20px;\r\n      font-weight: 500;\r\n      color: #fff2a7;\r\n      outline: none;\r\n\r\n      &::placeholder {\r\n        font-weight: 500;\r\n        font-size: 16px;\r\n        color: rgba(@mainColor, .5);\r\n      }\r\n    }\r\n  }\r\n\r\n  &__hrl {\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 178px;\r\n    width: 380px;\r\n    height: 460px;\r\n    transform: translateX(-50%);\r\n    text-align: center;\r\n\r\n    &-viewport {\r\n      position: absolute;\r\n      left: 0;\r\n      top: 0;\r\n      width: 380px;\r\n      height: 380px;\r\n      overflow: hidden;\r\n      // border-radius: 50%;\r\n      background: url(\"~@/assets/avatar-bg.svg\") no-repeat;\r\n      background-size: 100% 100%;\r\n\r\n      .img-bg {\r\n        position: absolute;\r\n        left: 15px;\r\n        top: 15px;\r\n        width: 350px;\r\n        height: 350px;\r\n        background-size: 100% 100%;\r\n        clip-path: circle(50%);\r\n        border-radius: 50%;\r\n      }\r\n    }\r\n\r\n    span {\r\n      position: absolute;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n\r\n      display: block;\r\n      height: 56px;\r\n      line-height: 56px;\r\n      color: #fef1ba;\r\n      font-size: 40px;\r\n      box-sizing: border-box;\r\n      text-align: center;\r\n    }\r\n  }\r\n\r\n  &__lpd {\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 178px;\r\n    width: 930px;\r\n    height: 460px;\r\n    transform: translateX(-50%);\r\n    text-align: left;\r\n    box-sizing: border-box;\r\n    padding: 0 50px;\r\n  }\r\n}\r\n\r\n.luckydraw-forbidden {\r\n  position: absolute;\r\n  right: 60px;\r\n  top: 0;\r\n  width: 462px;\r\n  height: 780px;\r\n  overflow: hidden;\r\n  box-sizing: border-box;\r\n  background-color: rgba(#000, .15);\r\n  border-radius: 10px;\r\n\r\n  transition: opacity .3s;\r\n  opacity: 1;\r\n\r\n  &__title {\r\n    text-align: center;\r\n    color: #fff2a7;\r\n    font-size: 30px;\r\n    font-weight: 400;\r\n    margin-block-start: 30px;\r\n    margin-block-end: 20px;\r\n  }\r\n  &__wrapper {\r\n    overflow: auto;\r\n    height: 670px;\r\n  }\r\n}\r\n\r\n.lucky-checkin {\r\n  position: absolute;\r\n  left: 0;\r\n  right: 0;\r\n  top: 0;\r\n  height: 50px;\r\n  width: 100%;\r\n  z-index: 100;\r\n\r\n  .lucky-checkin-button {\r\n    position: absolute;\r\n    top: 64px;\r\n    right: 0;\r\n    display: block;\r\n    width: 146px;\r\n    height: 50px;\r\n    background: url(\"~@/assets/checkin-button.svg\") no-repeat;\r\n    background-size: 100% 100%;\r\n  }\r\n\r\n  .lucky-white-list {\r\n    height: 860px;\r\n  }\r\n}\r\n\r\n.luck-session {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  right: 0;\r\n  height: 50px;\r\n  width: 100%;\r\n  z-index: 100;\r\n  text-align: center;\r\n\r\n  &-button {\r\n    position: absolute;\r\n    top: 114px;\r\n    right: 0;\r\n    display: block;\r\n    width: 146px;\r\n    height: 50px;\r\n    line-height: 50px;\r\n    text-align: center;\r\n    background: rgba(255,255,255,.15);\r\n    border-radius: 50px 0 0 50px;\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    color: #fff2a7;\r\n  }\r\n\r\n  .luck-board {\r\n    margin: 0 auto;\r\n    width: 60%;\r\n    height: 860px;\r\n  }\r\n}\r\n\r\n</style>\r\n\r\n\r\n<style lang=\"less\" scoped>\r\n.luckydraw-confirming {\r\n  .luckydraw-main__lpd {\r\n    width: 1070px;\r\n  }\r\n  .luckydraw-participant {\r\n    transition: opacity .3s;\r\n    opacity: 0;\r\n  }\r\n\r\n  .luckydraw-forbidden {\r\n    transition: opacity .3s;\r\n    opacity: 0;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0c8b0207&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0c8b0207&lang=less&scoped=true&\"\nimport style1 from \"./index.vue?vue&type=style&index=1&id=0c8b0207&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0c8b0207\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"register\"},[_c('p',{staticClass:\"title\"},[_vm._v(\"瓶子科技2021年会抽奖\")]),_c('van-row',{attrs:{\"type\":\"flex\",\"justify\":\"center\"}},[_c('van-col',{attrs:{\"span\":8}},[_c('van-uploader',{attrs:{\"after-read\":_vm.afterRead}},[_c('van-button',{staticClass:\"upload-face-button\",attrs:{\"plain\":\"\",\"type\":\"primary\"}},[_vm._v(\"上传人脸\")])],1)],1)],1),_c('van-image',{staticStyle:{\"margin-top\":\"1rem\",\"overflow\":\"hidden\"},attrs:{\"src\":_vm.avatar,\"width\":\"8rem\",\"height\":\"8rem\",\"round\":\"\",\"fit\":\"cover\"}}),_c('van-row',{staticClass:\"form\"},[_c('van-field',{attrs:{\"label\":\"用户名:\",\"placeholder\":\"请输入姓名\"},model:{value:(_vm.userName),callback:function ($$v) {_vm.userName=$$v},expression:\"userName\"}})],1),_c('van-row',{staticClass:\"submit-button\",attrs:{\"type\":\"flex\",\"justify\":\"center\"}},[_c('van-col',{attrs:{\"span\":\"20\"}},[_c('van-button',{attrs:{\"type\":\"primary\",\"size\":\"large\"},on:{\"click\":_vm.register}},[_vm._v(\"参与抽奖\")])],1)],1),_c('van-loading',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"toast-loading\",attrs:{\"size\":\"24px\"}},[_vm._v(\"请求中...\")]),_c('van-loading',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.uploading),expression:\"uploading\"}],staticClass:\"toast-loading\",attrs:{\"size\":\"24px\"}},[_vm._v(\"图片上传中...\")]),(_vm.success)?_c('div',{staticClass:\"register-success\"},[_c('p',{staticClass:\"register-success__title-head\"},[_vm._v(\"恭喜\")]),_c('p',{staticClass:\"register-success__title-body\"},[_vm._v(\"参与成功\")])]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as EXIF from 'exif-js'\r\nexport function rotateAndCompressImg (file) {\r\n  return new Promise((resolve, reject) => {\r\n    let img = new Image()\r\n    img.src = window.URL.createObjectURL(file)\r\n    img.onload = () => {\r\n      EXIF.getData(img, function () {\r\n        let orientation = EXIF.getTag(this, 'Orientation')\r\n        let canvas = document.createElement('canvas')\r\n        let ctx = canvas.getContext('2d')\r\n        switch (orientation) {\r\n          case 3: // 旋转180°\r\n            canvas.width = img.width\r\n            canvas.height = img.height\r\n            ctx.rotate((180 * Math.PI) / 180)\r\n            ctx.drawImage(img, -img.width, -img.height, img.width, img.height)\r\n            break\r\n          case 6: // 旋转90°\r\n            canvas.width = img.height\r\n            canvas.height = img.width\r\n            ctx.rotate((90 * Math.PI) / 180)\r\n            ctx.drawImage(img, 0, -img.height, img.width, img.height)\r\n            break\r\n          case 8: // 旋转-90°\r\n            canvas.width = img.height\r\n            canvas.height = img.width\r\n            ctx.rotate((-90 * Math.PI) / 180)\r\n            ctx.drawImage(img, -img.width, 0, img.width, img.height)\r\n            break\r\n          default: // 没有源信息的图片和正常的图片是不需要旋转的\r\n            canvas.width = img.width\r\n            canvas.height = img.height\r\n            ctx.drawImage(img, 0, 0, img.width, img.height)\r\n            break\r\n        }\r\n        canvas.toBlob(blob => {\r\n          if (/\\/(?:jpeg|png|jpg|gif)/i.test(blob.type) && blob.size > 1000000) {\r\n            let canvas = document.createElement('canvas')\r\n            let context = canvas.getContext('2d')\r\n            let img = new Image()\r\n            img.src = URL.createObjectURL(blob)\r\n            img.onload = () => {\r\n              let rate = img.height / img.width\r\n              canvas.width = 800\r\n              canvas.height = 800 * rate\r\n              context.drawImage(img, 0, 0, canvas.width, canvas.height)\r\n              canvas.toBlob(blob => {\r\n                resolve({\r\n                  content: canvas.toDataURL('image/jpeg', 0.92),\r\n                  file: blob\r\n                })\r\n              })\r\n            }\r\n            return\r\n          }\r\n          resolve({\r\n            content: canvas.toDataURL('image/jpeg', 0.92),\r\n            file: blob\r\n          })\r\n        }, 'image/jpeg', 0.92)\r\n      })\r\n    }\r\n  })\r\n}\r\n","import axios from 'axios'\r\n\r\nexport function upload (name, file) {\r\n  return new Promise(resolve => {\r\n    let url = '/api/minio/presignedUrl'\r\n    // 避免文件名重复\r\n    let name = (new Date()).getTime() + Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2)\r\n    axios.get(url, {params: {name}}).then((res) => {\r\n      console.log('upload.get res: ', res)\r\n\r\n      axios.put(res.data.data.url, file).then(re => {\r\n        console.log('put.put res: ', re)\r\n        if (re.status === 200) {\r\n          // get visit_url\r\n          resolve({code: 0, data: {visit_url: res.data.data.visit_url}})\r\n        } else {\r\n          resolve({code: -1, message: 'error'})\r\n        }\r\n      })\r\n    })\r\n  })\r\n}\r\n","<template>\r\n  <div class=\"register\">\r\n    <p class=\"title\">瓶子科技2021年会抽奖</p>\r\n\r\n    <van-row type=\"flex\" justify=\"center\">\r\n      <van-col :span=\"8\">\r\n        <van-uploader :after-read=\"afterRead\">\r\n          <van-button plain type=\"primary\" class=\"upload-face-button\">上传人脸</van-button>\r\n        </van-uploader>       \r\n      </van-col>\r\n      <!-- <van-col :span=\"8\">\r\n        <van-button plain type=\"default\" style=\"width: 4.4rem\">随机人脸</van-button>\r\n      </van-col> -->\r\n    </van-row>\r\n\r\n      <van-image :src=\"avatar\" width=\"8rem\" height=\"8rem\" style=\"margin-top: 1rem;overflow: hidden;\" round fit=\"cover\">\r\n      </van-image>\r\n\r\n    <van-row class=\"form\">\r\n      <van-field v-model=\"userName\" label=\"用户名:\" placeholder=\"请输入姓名\" />\r\n    </van-row>\r\n    <van-row type=\"flex\" justify=\"center\" class=\"submit-button\">\r\n      <van-col span=\"20\">\r\n        <van-button type=\"primary\" size=\"large\" @click=\"register\">参与抽奖</van-button>\r\n      </van-col>\r\n    </van-row>\r\n    <van-loading size=\"24px\" v-show=\"loading\" class=\"toast-loading\">请求中...</van-loading>\r\n    <van-loading size=\"24px\" v-show=\"uploading\" class=\"toast-loading\">图片上传中...</van-loading>\r\n\r\n    <!-- success -->\r\n    <div class=\"register-success\" v-if=\"success\">\r\n      <p class=\"register-success__title-head\">恭喜</p>\r\n      <p class=\"register-success__title-body\">参与成功</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport {Notify} from 'vant'\r\nimport { rotateAndCompressImg } from '@/utils/compress-img'\r\nimport { upload } from '@/utils/upload_api'\r\nimport Api from '@/api'\r\n\r\nconst KEY_SESSION_HISTORY = 'key-session-history-of-luckdraw'\r\n\r\nconst DefaultIntervalMinutes = 2 * 24 * 60\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      userName: '',\r\n      avatar: '',\r\n      session: '',\r\n      intervalMinutes: DefaultIntervalMinutes,\r\n      loading: false,\r\n      uploading: false,\r\n      success: false\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    FormDisabled () {\r\n      return !(this.userName && this.avatar)\r\n    }\r\n  },\r\n\r\n  created () {\r\n    this.session = this.$route.query.session || '0'\r\n    this.intervalMinutes = Number.parseInt(this.$route.query.interval || DefaultIntervalMinutes)\r\n  },\r\n\r\n  methods: {\r\n    validateAndSaveSession () {\r\n      // session like this: {id: xxxx, intervalMs: 1111111, updateTimestamp: 234324324 }\r\n      let history = this.sessionHistory()\r\n      let preSession = history[this.session]\r\n      let thisSession = { id: this.session, intervalMs: this.intervalMinutes * 60 * 1000, updateTimestamp: Date.now() }\r\n      if (this.preSessionExpired(preSession, thisSession)) {\r\n        history[this.session] = thisSession\r\n        localStorage.setItem(KEY_SESSION_HISTORY, JSON.stringify(history))\r\n        return true\r\n      }\r\n      return false\r\n    },\r\n\r\n    clearSession () {\r\n      localStorage.removeItem(KEY_SESSION_HISTORY)\r\n    },\r\n\r\n    preSessionExpired (preSession, thisSession) {\r\n      if (!preSession) {\r\n        return true\r\n      }\r\n      let diffMs = thisSession.updateTimestamp - preSession.updateTimestamp\r\n      return diffMs > preSession.intervalMs\r\n    },\r\n\r\n    sessionHistory () {\r\n      let history = localStorage.getItem(KEY_SESSION_HISTORY) || \"{}\"\r\n      return JSON.parse(history)\r\n    },\r\n\r\n    register () {\r\n      if (!this.userName || !this.avatar || !this.session) {\r\n        let emptyFields = []\r\n        !this.userName.trim() && emptyFields.push('姓名')\r\n        !this.avatar.trim() && emptyFields.push('图像')\r\n        return this.toast(emptyFields.join('、') + '必填', 'danger')\r\n      }\r\n      if (this.loading) {\r\n        return this.toast('已在请求中', 'danger')\r\n      }\r\n\r\n      this.loading = true\r\n      Api.register(this.userName.trim(), this.avatar.trim(), this.session.trim()).then(res => {\r\n        this.loading = false\r\n\r\n        if (res.code === 0) {\r\n          this.toast('参加成功')\r\n          this.success = true\r\n        } else if (res.code === 11000) { // duplicate user name\r\n          this.toast('此用户名已参加', 'warning')\r\n        } else {\r\n          // this.clearSession()\r\n          this.toast(res.message || '参加失败，请稍后重试', 'warning')\r\n        }\r\n      }).catch(err => {\r\n        this.toast(err || '网络或者服务器异常', 'danger')\r\n        this.loading = false\r\n      })\r\n    },\r\n\r\n    afterRead (file) {\r\n      rotateAndCompressImg(file.file).then(contentAndFile => {\r\n        this.uploading = true\r\n        upload('img', contentAndFile.file).then(res => {\r\n          this.uploading = false\r\n          if (res.code === 0) {\r\n            this.avatar = res.data.visit_url\r\n          } else {\r\n            this.toast(res.message || '上传人脸图片失败', 'danger')\r\n          }\r\n        }).catch (err => {\r\n          this.uploading = false\r\n          this.toast(err || '上传人脸图片失败', 'danger')\r\n        })\r\n      })\r\n    },\r\n\r\n    toast (message, type=\"success\") {\r\n      Notify({ type, message })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@mainColor: #990008;\r\n\r\n.register {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  text-align: center;\r\n  background: linear-gradient(#ccc, @mainColor);\r\n\r\n  .title {\r\n    font-weight: 600;\r\n    color: @mainColor;\r\n  }\r\n\r\n  .form {\r\n    margin-top: 10%;\r\n  }\r\n\r\n  .upload-face-button {\r\n    border: 1px solid @mainColor;\r\n    color: @mainColor;\r\n  }\r\n\r\n  .submit-button {\r\n    margin-top: 10%;\r\n\r\n    .van-button--primary {\r\n      background: @mainColor;\r\n      border: 1px solid @mainColor;\r\n      box-shadow: 0 0 1em rgba(@mainColor, .8);\r\n    }\r\n  }\r\n\r\n  .toast-loading {\r\n    display: block;\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 50%;\r\n    padding: 10px;\r\n    background: rgba(0,0,0,.5);\r\n    transform: translate(-50%, -50%);\r\n    border: 1px solid @mainColor;\r\n  }\r\n}\r\n\r\n\r\n// 注册成功\r\n.register-success {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n\r\n  background: linear-gradient(#ccc, @mainColor);\r\n  padding-top: 20%;\r\n\r\n  &__title-head {\r\n    font-size: 36px;\r\n    font-weight: 600;\r\n\r\n    color: @mainColor;\r\n  }\r\n\r\n  &__title-body {\r\n    font-size: 28px;\r\n    color: #fff2a7;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./register.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./register.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./register.vue?vue&type=template&id=a4980506&scoped=true&\"\nimport script from \"./register.vue?vue&type=script&lang=js&\"\nexport * from \"./register.vue?vue&type=script&lang=js&\"\nimport style0 from \"./register.vue?vue&type=style&index=0&id=a4980506&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a4980506\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page\"},[_c('div',{staticClass:\"draw-luck\"},[_c('div',{staticClass:\"draw-luck-title luck-title\"},[_vm._v(\" 当前奖品 \")]),(_vm.currentLuckSession)?_c('div',{staticClass:\"draw-luck-prize\"},[_vm._v(\" \"+_vm._s(_vm.currentLuckSession.prizes)+\" \"),_c('span',{staticStyle:{\"margin\":\"0 0.3rem\",\"color\":\"#ffd790\"}},[_vm._v(\"x\")]),_vm._v(\" \"+_vm._s(_vm.currentLuckSession.count)+\" \")]):_c('div',{staticClass:\"draw-luck-prize\"},[_vm._v(\" 暂无抽奖 \")]),(false)?_c('div',{staticClass:\"draw-luck-luckypeople\"},[_c('div',{staticClass:\"luckypeople-title\"},[_vm._v(\"参与名单\")]),_c('div',{staticClass:\"luckypeople-display\"},[_c('span',{staticClass:\"word-loop-anim\",staticStyle:{\"display\":\"inline-block\",\"height\":\"100%\",\"margin-left\":\"100%\",\"word-break\":\"keep-all\",\"white-space\":\"nowrap\"},style:(_vm.wordsLoopStyle)},[_vm._v(\" \"+_vm._s(_vm.allPeopleNames)+\" \")])])]):_vm._e(),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-inner\",style:({width: _vm.progressValue + '%'})})]),_c('div',{staticClass:\"luck-button\",class:[_vm.currentLuckSession ? 'breath' : '' ],style:(_vm.luckButtonStyle),on:{\"click\":_vm.onLuckButtonClick}}),_c('div',{staticClass:\"luckypeople-table\"},[_c('span',{staticClass:\"luckypeople-table-title luck-title\"},[_vm._v(\" 中奖名单 \")]),_c('div',{staticClass:\"luck-table\"},[_vm._m(0),_c('div',{staticClass:\"luck-table-body\"},_vm._l((_vm.allLucks),function(luck,index){return _c('div',{key:index,staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.prize))]),_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.count))]),_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.owner))])])}),0)])]),_c('div',{staticClass:\"dialog\",class:{ 'dialog-show' : _vm.newLucks.length > 0 }},[_c('div',{staticClass:\"close-button\",on:{\"click\":_vm.updatePreAllLucks}},[_c('el-button',{attrs:{\"type\":\"danger\",\"icon\":\"el-icon-circle-close\",\"circle\":\"\"}})],1),_c('div',{staticClass:\"dialog-inner\"},[_c('div',{staticClass:\"luckypeople-table\"},[_c('span',{staticClass:\"luckypeople-table-title luck-title\"},[_vm._v(\" 中奖名单 \")]),_c('div',{staticClass:\"luck-table\"},[_vm._m(1),_c('div',{staticClass:\"luck-table-body\"},_vm._l((_vm.newLucks),function(luck,index){return _c('div',{key:index,staticClass:\"row\"},[_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.prize))]),_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.count))]),_c('div',{staticClass:\"col\"},[_vm._v(_vm._s(luck.owner))])])}),0)])])])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"luck-table-head row\"},[_c('div',{staticClass:\"head col\"},[_vm._v(\"奖品名称\")]),_c('div',{staticClass:\"head col\"},[_vm._v(\"奖品数量\")]),_c('div',{staticClass:\"head col\"},[_vm._v(\"中奖名单\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"luck-table-head row\"},[_c('div',{staticClass:\"head col\"},[_vm._v(\"奖品名称\")]),_c('div',{staticClass:\"head col\"},[_vm._v(\"奖品数量\")]),_c('div',{staticClass:\"head col\"},[_vm._v(\"中奖名单\")])])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"page\">\r\n    <div class=\"draw-luck\">\r\n      <div class=\"draw-luck-title luck-title\">\r\n        当前奖品\r\n      </div>\r\n\r\n      <div \r\n        v-if=\"currentLuckSession\" \r\n        class=\"draw-luck-prize\"\r\n      >\r\n        {{currentLuckSession.prizes}}\r\n        <span style=\"margin: 0 0.3rem;color:#ffd790;\">x</span>\r\n        {{currentLuckSession.count}}\r\n      </div>\r\n      <div \r\n        v-else\r\n        class=\"draw-luck-prize\"\r\n      > \r\n        暂无抽奖\r\n      </div>\r\n\r\n      <div\r\n        v-if=\"false\"\r\n        class=\"draw-luck-luckypeople\"\r\n      >\r\n        <div class=\"luckypeople-title\">参与名单</div>\r\n        <div class=\"luckypeople-display\">\r\n          <span \r\n            class=\"word-loop-anim\"\r\n            style=\"display: inline-block;height: 100%;margin-left:100%;word-break:keep-all;white-space:nowrap;\"\r\n            :style=\"wordsLoopStyle\"\r\n          >\r\n          {{allPeopleNames}}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n\r\n      <!-- 能量条 -->\r\n      <div class=\"progress\">\r\n        <!-- <progress max=\"100\" :value=\"progressValue\"/> -->\r\n        <div \r\n          class=\"progress-inner\" \r\n          :style=\"{width: progressValue + '%'}\">\r\n        </div>\r\n      </div>\r\n      <div \r\n        class=\"luck-button\"\r\n        :class=\"[currentLuckSession ? 'breath' : '' ]\"\r\n        :style=\"luckButtonStyle\"\r\n        @click=\"onLuckButtonClick\"\r\n      >\r\n      </div>\r\n\r\n      <!-- 中将名单 -->\r\n      <div class=\"luckypeople-table\">\r\n        <span class=\"luckypeople-table-title luck-title\">\r\n          中奖名单\r\n        </span>\r\n        <div class=\"luck-table\">\r\n          <div class=\"luck-table-head row\">\r\n            <div class=\"head col\">奖品名称</div>\r\n            <div class=\"head col\">奖品数量</div>\r\n            <div class=\"head col\">中奖名单</div>\r\n          </div>\r\n          <div class=\"luck-table-body\">\r\n            <div \r\n              v-for=\"(luck, index) in allLucks\" \r\n              :key=\"index\" \r\n              class=\"row\"\r\n            >\r\n              <div class=\"col\">{{luck.prize}}</div>\r\n              <div class=\"col\">{{luck.count}}</div>\r\n              <div class=\"col\">{{luck.owner}}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 当前中奖的用户的弹窗 -->\r\n      <div \r\n        class=\"dialog\" \r\n        :class=\"{ 'dialog-show' : newLucks.length > 0 }\"\r\n      >\r\n        <div \r\n          class=\"close-button\"\r\n          @click=\"updatePreAllLucks\"\r\n        >\r\n          <el-button \r\n            type=\"danger\" \r\n            icon=\"el-icon-circle-close\" \r\n            circle \r\n          />\r\n        </div>\r\n        <div class=\"dialog-inner\">\r\n          <div class=\"luckypeople-table\">\r\n            <span class=\"luckypeople-table-title luck-title\">\r\n              中奖名单\r\n            </span>\r\n            <div class=\"luck-table\">\r\n              <div class=\"luck-table-head row\">\r\n                <div class=\"head col\">奖品名称</div>\r\n                <div class=\"head col\">奖品数量</div>\r\n                <div class=\"head col\">中奖名单</div>\r\n              </div>\r\n              <div class=\"luck-table-body\">\r\n                <div \r\n                  v-for=\"(luck, index) in newLucks\"\r\n                  :key=\"index\" \r\n                  class=\"row\"\r\n                >\r\n                  <div class=\"col\">{{luck.prize}}</div>\r\n                  <div class=\"col\">{{luck.count}}</div>\r\n                  <div class=\"col\">{{luck.owner}}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>        \r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport Api from '../../api/index'\r\n\r\nexport default {\r\n  \r\n  data () {\r\n    return {\r\n      session: this.$route.params.session,\r\n      luckySessions: [],\r\n      luckyPeople: [],\r\n\r\n      nowTimestamp: Date.now(),\r\n      allPeopleNames: '',\r\n      luckButtonClicks: 0,\r\n      luckButtonHandler: 0,\r\n\r\n      preAllLucks: [] // 保存上一轮的的幸运儿\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    wordsLoopStyle () {\r\n      // 20个字，5s\r\n      const duration = this.allPeopleNames.length / 40 * 5\r\n      return {\r\n        animationDuration: `${duration}5s`,\r\n      }\r\n    },\r\n\r\n    progressValue () {\r\n      return Math.min(this.luckButtonClicks / 1.4, 100)\r\n    },\r\n\r\n    luckButtonStyle () {\r\n      if (this.luckButtonClicks <= 0) {\r\n        return {\r\n          animationDuration: '0ms'\r\n        }\r\n      }\r\n\r\n      const maxClicks = 2000\r\n      \r\n      const durationMs = maxClicks / this.luckButtonClicks\r\n      return {\r\n        animationDuration: `${durationMs}ms`\r\n      }\r\n    },\r\n\r\n    // 是否可以抽奖了\r\n    couldDraw () {\r\n      // return this.currentLuckSession && this.currentLuckSession.startTime <= this.nowTimestamp\r\n      return !!this.currentLuckSession\r\n    },\r\n\r\n    currentLuckSession () {\r\n      const sessions = this.luckySessions.filter(s => !s.finished)\r\n      sessions.sort((a, b) => a.startTime - b.startTime)\r\n      return sessions[0]\r\n    },\r\n\r\n    luckSessionStartTime () {\r\n      if (!this.currentLuckSession) {\r\n        return '无'\r\n      }\r\n\r\n      let date = new Date(this.currentLuckSession.startTime)\r\n      return [date.getFullYear(), date.getMonth() + 1, date.getDate()].join('/') + '  ' + [date.getHours(), date.getMinutes(), date.getSeconds()].join(':')\r\n    },\r\n\r\n    allLucks () {\r\n      const list = this.luckyPeople.map(lp => {\r\n        const session = this.luckySessions.find(ls => ls.luckId === lp.luckId)\r\n        if (!session) {\r\n          return void 0\r\n        }\r\n        return {...lp, prize: session.prizes }\r\n      })\r\n      const allLucks = []\r\n      console.log('allLucks.list: ', list)\r\n      list.forEach(item => {\r\n        item?.users.forEach(user => {\r\n          console.log(\"user: \", user)\r\n          allLucks.push({ prize: item.prize, count: 1, owner: user[0] })\r\n        })\r\n      })\r\n\r\n      console.log('allLucks: ', allLucks)\r\n      return allLucks\r\n    },\r\n\r\n    newLucks () {\r\n      if (this.allLucks.length === this.preAllLucks.allLucks) {\r\n        return []\r\n      }\r\n\r\n      // 产生了新的抽奖\r\n      let diff = this.allLucks.filter(x => -1 === this.preAllLucks.findIndex(y => y.prize === x.prize && y.count === x.count && y.owner === x.owner))\r\n      return diff.slice(0)\r\n    }\r\n  },\r\n\r\n  created () {\r\n    if (!this.session) {\r\n      this.$message.error('URL中请指定session')\r\n    } else {\r\n      this.requestLuckSessions()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n\r\n    requestLuckSessions () {\r\n      Api.fetchLuckSessions(this.session).then(res => {\r\n        if (res.code === 0) {\r\n          this.luckySessions = res.data.luckSessions\r\n          this.luckyPeople = res.data.luckyPeople\r\n        }\r\n\r\n        // 每2秒拉一次数据\r\n        setTimeout(this.requestLuckSessions.bind(this), 2000)\r\n      }).catch(err => {\r\n        // 每3秒拉一次数据\r\n        setTimeout(this.requestLuckSessions.bind(this), 3000)\r\n      })\r\n    },\r\n\r\n    onLuckButtonClick () {\r\n      if (!this.couldDraw) {\r\n        return this.$message.error('还没有创建新的抽奖！')\r\n      }\r\n      \r\n      // 开始抽奖的动画\r\n      this.luckButtonClicks += 1\r\n      console.log('luckButtonClicks: ', this.luckButtonClicks)\r\n\r\n      // 250ms之后，开始冷静\r\n      clearTimeout(this.luckButtonHandler)\r\n      this.luckButtonHandler = setTimeout(() => {\r\n        this.calmdown()\r\n      }, 250)\r\n    },\r\n\r\n    calmdown () {\r\n      clearTimeout(this.luckButtonHandler)\r\n      if (this.luckButtonClicks < 5) {\r\n        this.luckButtonClicks = 0\r\n        return\r\n      }\r\n      this.luckButtonClicks = this.luckButtonClicks * 0.9 // 10%的速率下降\r\n\r\n      this.luckButtonHandler = setTimeout(() => {\r\n        this.calmdown()\r\n      }, 250)\r\n    },\r\n\r\n    updatePreAllLucks () {\r\n      this.preAllLucks = this.allLucks.slice(0)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n\r\n@keyframes wordloop {\r\n  0% {\r\n    transform: translateX(0);\r\n  }\r\n  100% {\r\n    transform: translateX(-120%);\r\n  }\r\n}\r\n\r\n@keyframes zoom {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n  40% {\r\n    transform: scale(1.2);\r\n  }\r\n  60% {\r\n    transform: scale(1.1);\r\n  }\r\n\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n\r\n.word-loop-anim {\r\n  animation: 5s wordloop linear infinite normal;\r\n}\r\n\r\n.breath {\r\n  animation: zoom 1s linear infinite;\r\n  transform: translateZ(0);  // 开启硬件加速\r\n  -webkit-backface-visibility: hidden;\r\n  -webkit-perspective: 1000;\r\n}\r\n</style>\r\n\r\n<style lang=\"less\" scoped>\r\n@baseFontSize: 20rem;\r\n\r\n.progress {\r\n  width: 60%;\r\n  height: 0.6rem;\r\n  border-radius: 0.3rem;\r\n  line-height: 0;\r\n  overflow: hidden;\r\n  background: #fff;\r\n  margin-top: 0.5rem;\r\n\r\n  &-inner {\r\n    height: 100%;\r\n    background: #f9ac47;\r\n    border-radius: 0.2rem;\r\n    transition: width 50ms;\r\n  }\r\n}\r\n\r\n.page {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  background-color: #9b0005;\r\n  background-image: url('../../assets/luck-bg.png');\r\n  background-size: 100% 100%;\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  overflow-x: hidden; \r\n  overflow-y: auto;\r\n\r\n  .draw-luck {\r\n    width: 100vw;\r\n    height: auto;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n  .luck-title {\r\n    position: relative;\r\n    font-size: 1.05rem;\r\n    font-weight: 600;\r\n    color: #FFD790;\r\n\r\n    &::before {\r\n      position: absolute;\r\n      left: -1.15rem;\r\n      top: 50%;\r\n      display: block;\r\n      width: 0.9rem;\r\n      height: 0.55rem;\r\n      content: \"\";\r\n      background: url(\"../../assets/icon_mark.svg\") no-repeat;\r\n      background-size: 100% 100%;\r\n      transform: translateY(-50%);\r\n    }\r\n    &::after {\r\n      position: absolute;\r\n      top: 50%;\r\n      right: -1.15rem;\r\n      transform: translateY(-50%);\r\n      display: block;\r\n      width: 0.9rem;\r\n      height: 0.55rem;\r\n      content: \"\";\r\n      background: url(\"../../assets/icon_mark.svg\") no-repeat;\r\n      background-size: 100% 100%;\r\n    }    \r\n  }\r\n\r\n  &-title {\r\n    position: relative;\r\n    margin-top: 1.8rem;\r\n  }\r\n\r\n  &-prize {\r\n    width: 295/@baseFontSize;\r\n    line-height: 35/@baseFontSize;\r\n    text-align: center;\r\n    font-size: 25/@baseFontSize;\r\n    color: #fff;\r\n    font-weight: 600;\r\n    margin-top: 6/@baseFontSize;\r\n    word-break: break-all;\r\n  }\r\n\r\n  &-luckypeople {\r\n    margin-top: 24/@baseFontSize;\r\n    text-align: center;\r\n\r\n    .luckypeople-title {\r\n      font-size: 21/@baseFontSize;\r\n      color: #ffd790;\r\n      font-weight: 600;\r\n      line-height: 29.5/@baseFontSize;\r\n      height: 29.5/@baseFontSize;\r\n    }\r\n\r\n    .luckypeople-display {\r\n      position: relative;\r\n      width: 295/@baseFontSize;\r\n      height: 35/@baseFontSize;\r\n      line-height: 35/@baseFontSize;\r\n      margin-top: 6/@baseFontSize;\r\n      font-size: 25/@baseFontSize;\r\n      color: #fff;\r\n      overflow: hidden;\r\n    }\r\n  }\r\n\r\n  .luck-button {\r\n    width: 191/@baseFontSize;\r\n    height: 191/@baseFontSize;\r\n    margin-top: 29/@baseFontSize;\r\n    background: url(\"../../assets/luck_btn.png\") no-repeat;\r\n    background-size: 100% 100%;\r\n    will-change: transform;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .luckypeople-table {\r\n    margin-top: 23.5/@baseFontSize;\r\n    text-align: center;\r\n    padding-bottom: 1.8rem;\r\n\r\n    &-title {\r\n      margin-bottom: 15/@baseFontSize;\r\n    }\r\n\r\n    .luck-table {\r\n      width: 329.5/@baseFontSize;\r\n      height: auto;\r\n      background: rgba(255,215,144,0.25);\r\n      border: 1/@baseFontSize solid rgba(255, 215, 144, 0.6);\r\n      border-radius: 17/@baseFontSize;\r\n      padding: 1rem 0;\r\n      margin-top: 15/@baseFontSize;\r\n\r\n      .row {\r\n        width: 100%;\r\n        display: flex;\r\n        text-align: center;\r\n        justify-content: space-between;\r\n        flex-wrap: nowrap;\r\n        align-items: center;\r\n\r\n        .col {\r\n          width: 33.3%;\r\n          line-height: 21/@baseFontSize;\r\n          font-weight: 600;\r\n          box-sizing: border-box;\r\n          padding: 0 5/@baseFontSize;\r\n        }\r\n      }\r\n\r\n      .row + .row {\r\n        margin-top: 16/@baseFontSize;\r\n      }\r\n\r\n      &-head {\r\n        color: #fff;\r\n        font-weight: 600;\r\n        font-size: 15/@baseFontSize;\r\n      }\r\n      &-body {\r\n        margin-top: 16/@baseFontSize;\r\n        font-size: 15/@baseFontSize;\r\n        color: #ffd790;\r\n        font-weight: 600;\r\n      }\r\n    }\r\n  }\r\n}\r\n}\r\n\r\n\r\n.dialog {\r\n  position: fixed;\r\n  left: 0;\r\n  top: 0;\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n  transition: 0.3s transform ease-in-out;\r\n  background: rgba(0,0,0,0.5);\r\n  left: -200%;\r\n  transform: scale(0);\r\n  overflow: hidden;\r\n\r\n  &-show {\r\n    left: 0;\r\n    transform: scale(1);\r\n  }\r\n\r\n  .close-button {\r\n    position: absolute;\r\n    width: 40/20rem;\r\n    height: 40/20rem;\r\n    border-radius: 50%;\r\n    bottom: 25/20rem;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    text-align: center;\r\n    line-height: 40/20rem;\r\n    z-index: 2;\r\n  }\r\n\r\n  @paddingTB: 20/20rem;\r\n\r\n  .dialog-inner {\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 50%;\r\n    transform: translate(-50%, -50%);\r\n    padding-left: 10/20rem;\r\n    padding-right: 10/20rem;\r\n    padding-top: @paddingTB;\r\n    padding-bottom: @paddingTB;\r\n\r\n    background: #333;\r\n    border-radius: 8/20rem;\r\n    max-height: 60%;\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n    background: #9b0005;\r\n    box-shadow: rgba(50, 50, 93, 0.25) 0px 2/20rem 5/20rem -1/20rem, rgba(0, 0, 0, 0.3) 0px 1/20rem 3/20rem -1/20rem;\r\n    \r\n\r\n    .luckypeople-table {\r\n      margin-top: 0;\r\n      padding-bottom: 0;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./good-luck.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./good-luck.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./good-luck.vue?vue&type=template&id=12ede7ec&scoped=true&\"\nimport script from \"./good-luck.vue?vue&type=script&lang=js&\"\nexport * from \"./good-luck.vue?vue&type=script&lang=js&\"\nimport style0 from \"./good-luck.vue?vue&type=style&index=0&lang=less&\"\nimport style1 from \"./good-luck.vue?vue&type=style&index=1&id=12ede7ec&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"12ede7ec\",\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\r\nimport Router from 'vue-router'\r\nimport Index from '@/pages/index/index.vue'\r\nimport Register from '@/pages/register/register.vue'\r\nimport GoodLuck from '@/pages/good-luck/good-luck.vue'\r\n\r\nVue.use(Router)\r\n\r\nexport default new Router({\r\n  mode: 'history',\r\n  base: '/',\r\n  routes: [\r\n    {\r\n      path: '/',\r\n      name: 'index',\r\n      alias: '/index',\r\n      component: Index\r\n    },\r\n    {\r\n      path: '/register',\r\n      name: 'register',\r\n      component: Register\r\n    },\r\n    {\r\n      path: '/goodluck/:session',\r\n      name: 'goodluck',\r\n      component: GoodLuck\r\n    }\r\n  ]\r\n})\r\n","import Vue from 'vue'\r\nimport App from './App.vue'\r\nimport ElementUI from 'element-ui'\r\nimport 'element-ui/lib/theme-chalk/index.css'\r\nimport Vant from 'vant'\r\nimport 'vant/lib/index.css';\r\n\r\nimport router from './router/index'\r\nimport _ from 'lodash'\r\n\r\nVue.config.productionTip = false\r\n\r\nVue.use(ElementUI)\r\nVue.use(Vant)\r\n\r\nVue.prototype._ = _ // load lodash\r\n\r\nnew Vue({\r\n  router,\r\n  render: h => h(App),\r\n}).$mount('#app')\r\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./luck-board.vue?vue&type=style&index=1&lang=less&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-people-display.vue?vue&type=style&index=0&id=68a505ad&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-white-list.vue?vue&type=style&index=0&id=13242f13&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./good-luck.vue?vue&type=style&index=0&lang=less&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./lucky-image-grid.vue?vue&type=style&index=0&id=ac904526&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./register.vue?vue&type=style&index=0&id=a4980506&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=0c8b0207&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=1&id=0c8b0207&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./luck-board.vue?vue&type=style&index=0&id=53640355&lang=less&scoped=true&\""],"sourceRoot":""}