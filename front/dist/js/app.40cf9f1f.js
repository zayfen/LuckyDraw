(function(t){function e(e){for(var i,r,o=e[0],c=e[1],l=e[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&h.push(a[r][0]),a[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(h.length)h.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},a={app:0},s=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},"19d1":function(t,e,n){},2:function(t,e){},"246c":function(t,e,n){"use strict";var i=n("7bb1"),a=n.n(i);a.a},"2f11":function(t,e,n){},3:function(t,e){},"33e8":function(t,e,n){"use strict";var i=n("19d1"),a=n.n(i);a.a},"3c9f":function(t,e,n){"use strict";var i=n("55bf"),a=n.n(i);a.a},4:function(t,e){},"46b5":function(t,e,n){"use strict";var i=n("2f11"),a=n.n(i);a.a},"55bf":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("2d98"),n("041d"),n("3466"),n("c412");var i=n("a59a"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],r=n("5511"),o={},c=Object(r["a"])(o,a,s,!1,null,null,null),l=c.exports,u=n("2ca7"),d=n.n(u),h=(n("46c6"),n("2b1e")),p=(n("6cd8"),n("c478")),f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"luckydraw"},[t._m(0),n("el-row",{staticStyle:{position:"absolute",top:"170px",left:"0",right:"0",bottom:"0"}},[n("el-col",{staticClass:"luckydraw-participant",attrs:{span:6}},[n("h4",{staticClass:"luckydraw-participant__title"},[t._v(" 可参与抽奖人数("+t._s(t.validParticipantList.length)+") ")]),n("lucky-image-grid",{staticClass:"luckydraw-participant__wrapper",attrs:{data:t.validParticipantList}})],1),n("el-col",{staticClass:"luckydraw-main",attrs:{span:12}},[t.context.state===t.context.S_START?n("el-button",{staticClass:"luckydraw-main__button luckydraw-main__start",attrs:{size:"large",round:!0,type:"primary"},on:{click:function(e){return t.onDrawButtonClick(t.context.S_START)}}}):t._e(),t.context.state===t.context.S_DRAWING?n("el-button",{staticClass:"luckydraw-main__button luckydraw-main__drawing",attrs:{size:"large",round:!0,type:"primary"},on:{click:function(e){return t.onDrawButtonClick(t.context.S_DRAWING)}}}):t._e(),t.context.state===t.context.S_CONFIRM?n("el-row",{staticClass:"luckydraw-main__confirm"},[n("el-col",{attrs:{span:12}},[n("el-button",{staticClass:"luckydraw-main__button luckydraw-main__confirm-yes",attrs:{round:!0,type:"primary"},on:{click:t.onConfirmYesButtonClick}},[t._v("抽奖有效")])],1),n("el-col",{attrs:{span:12}},[n("el-button",{staticClass:"luckydraw-main__button luckydraw-main__confirm-no",attrs:{type:"weak",round:!0},on:{click:t.toStartState}},[t._v("抽奖无效")])],1)],1):t._e(),n("el-input",{staticClass:"luckydraw-main__count-input",attrs:{placeholder:"中奖人数",max:t.validParticipantList.length,min:0},on:{input:t.onCountInputChange},model:{value:t.context.numLuckyPeople,callback:function(e){t.$set(t.context,"numLuckyPeople",t._n(e))},expression:"context.numLuckyPeople"}}),t.context.state===t.context.S_START||t.context.state===t.context.S_DRAWING?n("div",{staticClass:"luckydraw-main__hrl"},[n("div",{staticClass:"luckydraw-main__hrl-viewport"},t._l(t.validParticipantList,(function(e,i){return n("div",{key:i,staticClass:"img-bg",style:{backgroundImage:"url("+e.src+")",zIndex:i===t.context.randomIndex?"1":"0"}})})),0),n("span",{directives:[{name:"show",rawName:"v-show",value:t.context.randomIndex>-1,expression:"context.randomIndex > -1"}]},[t._v(" "+t._s(t.validParticipantList[t.context.randomIndex]&&t.validParticipantList[t.context.randomIndex].name)+" ")])]):n("lucky-people-display",{staticClass:"luckydraw-main__lpd",attrs:{data:t.context.luckyPeople}})],1),n("el-col",{staticClass:"luckydraw-forbidden",attrs:{span:6}},[n("h4",{staticClass:"luckydraw-forbidden__title"},[t._v("已中奖人数("+t._s(t.forbiddenParticipantList.length)+")")]),n("lucky-image-grid",{staticClass:"luckydraw-forbidden__wrapper",attrs:{data:t.forbiddenParticipantList}})],1)],1),n("div",{staticClass:"lucky-register-qrcode"},[n("lucky-register-qrcode",{attrs:{text:t.qrCodeContent}})],1),n("div",{staticClass:"lucky-checkin"},[n("a",{staticClass:"lucky-checkin-button",attrs:{href:"javascript: void 0;"},on:{click:t.toggleWhiteList}}),n("lucky-white-list",{style:{transform:t.whiteListVisible?"translateY(35px)":"translateY(130%)"},attrs:{list:t.participantNameList,session:t.session},on:{changed:t.onWhiteListChanged}})],1)],1)},m=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h2",{staticClass:"title"},[n("span",{staticStyle:{color:"#fcea00"}},[t._v("2019")]),t._v("年瓶子科技年会抽奖")])}],g=(n("6799"),n("8bc6"),n("5b96"),n("01d3"),n("ad15"),n("f5a1"),n("d502"),n("745d"),n("073b"),n("d4ee"),n("ff52"),n("1ede"),n("95a7"),n("0805"),n("5e0a"),n("a27f"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lucky-image-grid"},[n("div",{staticClass:"grid",class:[{left:"grid-left",center:"grid-center",right:"grid-right"}[t.align]||"center"]},t._l(t.data,(function(e,i){return n("div",{key:i,staticClass:"grid-item",class:[{small:"grid-item__small",normal:"grid-item__normal",large:"grid-item__large"}[t.size]||"normal",t.showname?"grid-item__showname":""]},[n("div",{staticClass:"grid-item__img",style:{backgroundImage:"url("+e.src+")"}}),n("div",{staticClass:"grid-item__container"},[n("h2",[t._v(t._s(e.name))])])])})),0)])}),v=[],y={name:"LuckyImageGrid",props:{data:{type:Array,default:function(){return[]}},align:{type:String,default:"center",validator:function(t){return["left","center","right"].indexOf(t)>-1}},size:{type:String,default:"normal",validator:function(t){return["normal","small","large"].indexOf(t)>-1}},showname:{type:Boolean,default:!1}},data:function(){return{}}},w=y,k=(n("c3e4"),Object(r["a"])(w,g,v,!1,null,"ac904526",null)),b=k.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lucky-register"},[n("img",{attrs:{src:t.qrcodeBase64Data}})])},x=[],L=n("5618"),C=n.n(L);function S(t){return C.a.toDataURL(t,{type:"svg",margin:0,version:6,errorCorrectionLevel:"H",color:{dark:"#000",light:"#FFFFFF"}})}var P={name:"LuckyRegisterQrcode",props:{text:String},data:function(){return{qrcodeBase64Data:""}},created:function(){var t=this;return S(this.text).then((function(e){t.qrcodeBase64Data=e}))}},I=P,N=(n("33e8"),Object(r["a"])(I,_,x,!1,null,"66c7cc76",null)),D=N.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lucky-white-list"},[n("el-card",{attrs:{shadow:"always"}},[n("h5",{staticStyle:{padding:"0",margin:"0",color:"#BD2B24"}},[t._v(" 签到表("+t._s(t.tableData.filter((function(e){return t.list.includes(e.name.trim())})).length)+"/"+t._s(t.tableData.filter((function(t){return t.name.trim()})).length)+") ")]),n("el-table",{staticClass:"lucky-white-list__table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"row-class-name":t.tableRowClassName,"empty-text":"签到表为空"}},[n("el-table-column",{attrs:{prop:"name",label:"姓名",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.editable?n("el-input",{attrs:{autofucus:"true",placeholder:"请输入姓名"},model:{value:e.row.name,callback:function(n){t.$set(e.row,"name",n)},expression:"scope.row.name"}}):n("span",{staticClass:"user-name",on:{dblclick:function(t){e.row.editable=!0}}},[t._v(t._s(e.row.name))])]}}])}),n("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.list.includes(e.row.name.trim())?n("i",{staticClass:"el-icon-circle-check",attrs:{color:"green"}}):n("i",{staticClass:"el-icon-circle-close"}),n("span",[t._v(t._s(t.list.includes(e.row.name.trim())?"已签到":"未签到"))])]}}])}),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return t.edit(e.$index,e.row)}}},[t._v(t._s(e.row.editable?"确定":"修改"))]),n("el-button",{attrs:{size:"mini",type:"weak"},on:{click:function(n){return t.deleteRow(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),n("el-button",{staticStyle:{margin:"10px auto"},attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:t.addWhiteItem}},[t._v("添加")])],1)],1)},j=[],R=n("2905"),W=n("6852"),M=n("2427"),$=n.n(M),A=$.a.create({timeout:5e3,withCredentials:!0});function E(){}A.interceptors.response.use((function(t){return t}),(function(t){return Promise.reject(t)})),E.prototype.get=function(t,e){var n=e||{};return new Promise((function(e,i){return A.get(t,{params:n}).then((function(t){e(t.data)})).catch((function(t){i(t)}))}))},E.prototype.post=function(t,e,n){var i=e||{};return new Promise((function(e,a){A.post(t,i,n).then((function(t){e(t.data)})).catch((function(t){a(t)}))}))};var T=new E;function B(t){return"/api/"+t}function q(t){return window.WebSocket?new window.WebSocket(t):window.MozWebSocket?new window.MozWebSocket(t):null}var z=function(){function t(){Object(R["a"])(this,t)}return Object(W["a"])(t,null,[{key:"register",value:function(t,e,n){var i=B("register");return T.post(i,{avatar:e,name:t,session:n})}},{key:"syncUser",value:function(t,e,n,i){var a=window.location.host,s="ws://"+a+"/syncUser?session="+t,r=q(s);if(null===r)throw Error("Browser dont support websocket");r.onopen=function(t){"function"===typeof e&&e(t)},r.onmessage=function(t){"function"===typeof n&&n(t)},r.onclose=function(t){"function"===typeof i&&i(t)}}},{key:"checkinList",value:function(t){var e=B("checkinList");return T.post(e,{session:t})}},{key:"upsertCheckinList",value:function(t,e){var n=B("upsertCheckinList");return T.post(n,{session:t,users:e})}}]),t}(),U=z,F={name:"LuckyWhiteList",props:{session:{type:String,required:!0},list:{type:Array,default:function(){return[]}}},data:function(){return{tableData:[]}},watch:{tableData:function(t,e){this.notifyWhiteListChange()}},created:function(){this.loadCheckinList()},methods:{tableRowClassName:function(t){var e=t.row;return this.list.includes(e.name.trim())?"checkin-status__yes":"checkin-status__no"},addWhiteItem:function(){this.tableData.push({name:"",editable:!0})},notifyWhiteListChange:function(){this.$emit("changed",this.tableData)},edit:function(t,e){e.editable=!e.editable,e.editable||(this.notifyWhiteListChange(),this.saveCheckinList())},deleteRow:function(t){this.tableData.splice(t,1),this.saveCheckinList()},saveCheckinList:function(){var t=this,e=[];this.tableData.forEach((function(t){return e.push(t.name)})),U.upsertCheckinList(this.session,e).then((function(e){0===e.code?t.$message({message:"签到表更新成功",type:"success"}):t.$message({message:"签到表更新失败",type:"error"})}))},loadCheckinList:function(){var t=this;U.checkinList(this.session).then((function(e){if(0===e.code){var n=e.data;n.forEach((function(e){return t.tableData.push({name:e,editable:!1})}))}else console.error("Api.checkinList error: ",e.message)})).catch((function(e){console.error("Api.checkinList error: ",e),t.$message({message:"签到表拉取失败",type:"error"})}))}}},G=F,J=(n("246c"),n("3c9f"),Object(r["a"])(G,O,j,!1,null,"78f149e3",null)),V=J.exports,Y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lucky-people-display"},[n("span",{staticClass:"lucky-people-display__title"},[t._v("中奖名单")]),n("div",{staticClass:"grid"},t._l(t.data,(function(e,i){return n("div",{key:i,staticClass:"grid-item"},[n("div",{staticClass:"grid-item__avatar",style:{backgroundImage:["url(",e.src,")"].join("")}}),n("span",{staticClass:"grid-item__name"},[t._v(t._s(e.name))])])})),0)])},H=[],Q={name:"LuckyPeopleDisplay",props:{data:{type:Array,default:function(){return[]}}}},K=Q,X=(n("73f6"),Object(r["a"])(K,Y,H,!1,null,"609868d4",null)),Z=X.exports,tt=n("a1ed");function et(){var t=new tt["a"];return function(e,n){return t.integer(e,n)}}var nt=et(),it={components:{LuckyImageGrid:b,LuckyRegisterQrcode:D,LuckyWhiteList:V,LuckyPeopleDisplay:Z},data:function(){return{participantList:[],session:"",whiteListVisible:!1,whiteList:[],context:{S_START:"start",S_DRAWING:"drawing",S_CONFIRM:"confirm",numLuckyPeople:1,state:"start",randomIndex:-1,luckyPeople:[],proposalLuckyPeopleIndexes:[]}}},computed:{qrCodeContent:function(){var t=function(t){return!("NaN"===Number.parseInt(t).toString())},e=this.$route.query.interval||"",n=window.location.protocol,i=window.location.host,a="".concat(n,"//").concat(i,"/register?session=").concat(this.session);return e&&t(e)&&(a="".concat(a,"&interval=").concat(e)),a},validParticipantList:function(){return this.checkedParticipantList.filter((function(t){return!t.forbidden}))},forbiddenParticipantList:function(){return this.checkedParticipantList.filter((function(t){return t.forbidden}))},checkedParticipantList:function(){var t=this;return this.participantList.filter((function(e){return t.whiteList.indexOf(e.name.trim())>-1}))},participantNameList:function(){return this.participantList.map((function(t){return t.name}))}},created:function(){this.session=this.$route.query.session||""+Date.now()},mounted:function(){U.syncUser(this.session,this.onWebSocketOpen.bind(this),this.onWebSocketMessage.bind(this),this.onWebSocketClose.bind(this)),window.addEventListener("beforeunload",(function(t){return t=t||window.event,t&&(t.returnValue="确定离开抽奖页面吗？"),"确定离开抽奖页面吗？"}))},methods:{onWebSocketOpen:function(){console.log("onWebSocketOpen")},onWebSocketMessage:function(t){if(t.data.length<=1)console.log("keep-alive heartbeat ",t.data);else{var e=JSON.parse(t.data);if(console.log("onWebSocketMessage Data: ",t.data),"AllUsers"===e.action){var n=this.loadLuckyNamesLocal();this.participantList=e.data.map((function(t){return{session:t.session,name:t.user.trim(),src:t.avatar,forbidden:n.indexOf(t.user.trim())>-1}}))}if("NewUser"===e.action){var i=this.whiteList.includes(e.data.user.trim());i?this.$message({message:e.data.user+" 签到成功",type:"success"}):this.$message({message:e.data.user+"(外部人员) 扫码加入",type:"warning"}),this.participantList.splice(0,0,{session:e.data.session,name:e.data.user,src:e.data.avatar,forbidden:!1})}}},onWebSocketClose:function(){console.log("onWebSocketClose")},toNextState:function(){var t={start:this.toDrawingState.bind(this),drawing:this.toConfrimState.bind(this),confirm:this.toStartState.bind(this)};t[this.context.state]()},toStartState:function(){this.context.state=this.context.S_START,this.context.numLuckyPeople=1,this.context.randomIndex=-1,this.context.luckyPeople.splice(0,this.context.luckyPeople.length),this.context.proposalLuckyPeopleIndexes.splice(0,this.context.proposalLuckyPeopleIndexes.length)},toDrawingState:function(){this.context.state=this.context.S_DRAWING,this.validParticipantList.length<=0||this.context.numLuckyPeople<1||this.startDrawing()},toConfrimState:function(){var t=this;this.context.state=this.context.S_CONFIRM,this.context.proposalLuckyPeopleIndexes.forEach((function(e){setTimeout((function(){t.context.luckyPeople.push(t.validParticipantList[e])}),500)}))},onDrawButtonClick:function(){this.validParticipantList.length<=0||this.context.numLuckyPeople<1||this.toNextState()},onConfirmYesButtonClick:function(){var t=this;this.context.luckyPeople.forEach((function(e){Array.from({length:t.participantList.length}).forEach((function(n,i){var a=t.participantList[i];a.name===e.name&&(a.forbidden=!0,t.participantList.splice(i,1,a))}))})),this.saveLuckyNamesLocal(),this.toNextState()},startDrawing:function(){var t=this;requestAnimationFrame((function(){var e=t.generateRandomIndexes(t.context.numLuckyPeople);t.context.randomIndex=e[0]||0,t.context.state===t.context.S_DRAWING?t.startDrawing():t.context.randomIndex=t.context.proposalLuckyPeopleIndexes[0]||0}))},generateRandomIndexes:function(t){var e=this.validParticipantList.length,n=this._.cloneDeep(this.validParticipantList);n=n.map((function(t,e){return t.index=e,t})),t=Math.min(t,e),this.context.proposalLuckyPeopleIndexes.splice(0,this.context.proposalLuckyPeopleIndexes.length);while(this.context.proposalLuckyPeopleIndexes.length<t){var i=nt(0,n.length-1);this.context.proposalLuckyPeopleIndexes.push(n[i].index),n.splice(i,1)}return this.context.proposalLuckyPeopleIndexes},toggleWhiteList:function(){console.log("toggle white list"),this.whiteListVisible=!this.whiteListVisible},onWhiteListChanged:function(t){var e=this;this.whiteList.splice(0,this.whiteList.length),t.map((function(t){return t.name})).forEach((function(t){return e.whiteList.push(t)}))},onCountInputChange:function(t){t>this.validParticipantList.length&&(this.context.numLuckyPeople=this.validParticipantList.length),t<this.validParticipantList.length&&(this.context.numLuckyPeople=Math.min(1,this.validParticipantList.length))},saveLuckyNamesLocal:function(){var t=this.forbiddenParticipantList.map((function(t){return t.name}))||[],e=this.session+"-lucky-names";localStorage.setItem(e,JSON.stringify(t))},loadLuckyNamesLocal:function(){var t=this.session+"-lucky-names",e=localStorage.getItem(t)||JSON.stringify([]);return JSON.parse(e)}}},at=it,st=(n("c8d7"),Object(r["a"])(at,f,m,!1,null,"1d8b0d54",null)),rt=st.exports,ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"register"},[n("p",{staticClass:"title"},[t._v("瓶子科技2019年会抽奖")]),n("van-row",{attrs:{type:"flex",justify:"center"}},[n("van-col",{attrs:{span:8}},[n("van-uploader",{attrs:{"after-read":t.afterRead}},[n("van-button",{staticClass:"upload-face-button",attrs:{plain:"",type:"primary"}},[t._v("上传人脸")])],1)],1)],1),n("van-image",{staticStyle:{"margin-top":"1rem",overflow:"hidden"},attrs:{src:t.avatar,width:"8rem",height:"8rem",round:"",fit:"cover"}}),n("van-row",{staticClass:"form"},[n("van-field",{attrs:{label:"用户名:",placeholder:"请输入姓名"},model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),n("van-row",{staticClass:"submit-button",attrs:{type:"flex",justify:"center"}},[n("van-col",{attrs:{span:"20"}},[n("van-button",{attrs:{type:"primary",size:"large"},on:{click:t.register}},[t._v("参与抽奖")])],1)],1),n("van-loading",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"toast-loading",attrs:{size:"24px"}},[t._v("请求中...")]),n("van-loading",{directives:[{name:"show",rawName:"v-show",value:t.uploading,expression:"uploading"}],staticClass:"toast-loading",attrs:{size:"24px"}},[t._v("图片上传中...")])],1)},ct=[],lt=(n("2dfc"),n("e841")),ut=(n("b9de"),n("39b9"),n("5501"));function dt(t){return new Promise((function(e,n){var i=new Image;i.src=window.URL.createObjectURL(t),i.onload=function(){ut["getData"](i,(function(){var t=ut["getTag"](this,"Orientation"),n=document.createElement("canvas"),a=n.getContext("2d");switch(t){case 3:n.width=i.width,n.height=i.height,a.rotate(180*Math.PI/180),a.drawImage(i,-i.width,-i.height,i.width,i.height);break;case 6:n.width=i.height,n.height=i.width,a.rotate(90*Math.PI/180),a.drawImage(i,0,-i.height,i.width,i.height);break;case 8:n.width=i.height,n.height=i.width,a.rotate(-90*Math.PI/180),a.drawImage(i,-i.width,0,i.width,i.height);break;default:n.width=i.width,n.height=i.height,a.drawImage(i,0,0,i.width,i.height);break}n.toBlob((function(t){if(/\/(?:jpeg|png|jpg|gif)/i.test(t.type)&&t.size>1e6){var i=document.createElement("canvas"),a=i.getContext("2d"),s=new Image;return s.src=URL.createObjectURL(t),void(s.onload=function(){var t=s.height/s.width;i.width=800,i.height=800*t,a.drawImage(s,0,0,i.width,i.height),i.toBlob((function(t){e({content:i.toDataURL("image/jpeg",.92),file:t})}))})}e({content:n.toDataURL("image/jpeg",.92),file:t})}),"image/jpeg",.92)}))}}))}function ht(t,e){return new Promise((function(t){var n="https://storage.xgeeklab.com/presignedUrl",i=(new Date).getTime()+Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2);$.a.get(n,{params:{name:i}}).then((function(n){$.a.put(n.data.data.url,e).then((function(e){200===e.status?t({code:0,data:{visit_url:n.data.data.visit_url}}):t({code:-1,message:"error"})}))}))}))}var pt="key-session-history-of-luckdraw",ft=2880,mt={data:function(){return{userName:"",avatar:"",session:"",intervalMinutes:ft,loading:!1,uploading:!1}},computed:{FormDisabled:function(){return!(this.userName&&this.avatar)}},created:function(){this.session=this.$route.query.session||"0",this.intervalMinutes=Number.parseInt(this.$route.query.interval||ft)},methods:{validateAndSaveSession:function(){var t=this.sessionHistory(),e=t[this.session],n={id:this.session,intervalMs:60*this.intervalMinutes*1e3,updateTimestamp:Date.now()};return!!this.preSessionExpired(e,n)&&(t[this.session]=n,localStorage.setItem(pt,JSON.stringify(t)),!0)},clearSession:function(){localStorage.removeItem(pt)},preSessionExpired:function(t,e){if(!t)return!0;var n=e.updateTimestamp-t.updateTimestamp;return n>t.intervalMs},sessionHistory:function(){var t=localStorage.getItem(pt)||"{}";return JSON.parse(t)},register:function(){var t=this;if(!this.userName||!this.avatar||!this.session){var e=[];return!this.userName.trim()&&e.push("姓名"),!this.avatar.trim()&&e.push("图像"),this.toast(e.join("、")+"必填","danger")}if(this.loading)return this.toast("已在请求中","danger");this.loading=!0,U.register(this.userName.trim(),this.avatar.trim(),this.session.trim()).then((function(e){t.loading=!1,0===e.code?t.toast("参加成功"):11e3===e.code?t.toast("此用户名已参加","warning"):t.toast(e.message||"参加失败，请稍后重试","warning")})).catch((function(e){t.toast(e||"网络或者服务器异常","danger"),t.loading=!1}))},afterRead:function(t){var e=this;dt(t.file).then((function(t){e.uploading=!0,ht("img",t.file).then((function(t){e.uploading=!1,0===t.code?e.avatar=t.data.visit_url:e.toast(t.message||"上传人脸图片失败","danger")})).catch((function(t){e.uploading=!1,e.toast(t||"上传人脸图片失败","danger")}))}))},toast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";Object(lt["a"])({type:e,message:t})}}},gt=mt,vt=(n("46b5"),Object(r["a"])(gt,ot,ct,!1,null,"450ebf08",null)),yt=vt.exports;i["default"].use(p["a"]);var wt=new p["a"]({mode:"history",base:"/",routes:[{path:"/",name:"index",alias:"/index",component:rt},{path:"/register",name:"register",component:yt}]}),kt=n("391c"),bt=n.n(kt);i["default"].config.productionTip=!1,i["default"].use(d.a),i["default"].use(h["a"]),i["default"].prototype._=bt.a,new i["default"]({router:wt,render:function(t){return t(l)}}).$mount("#app")},"73f6":function(t,e,n){"use strict";var i=n("e810"),a=n.n(i);a.a},"7bb1":function(t,e,n){},"8c8a":function(t,e,n){},c3e4:function(t,e,n){"use strict";var i=n("8c8a"),a=n.n(i);a.a},c8d7:function(t,e,n){"use strict";var i=n("f8c2"),a=n.n(i);a.a},e810:function(t,e,n){},f8c2:function(t,e,n){}});
//# sourceMappingURL=app.40cf9f1f.js.map